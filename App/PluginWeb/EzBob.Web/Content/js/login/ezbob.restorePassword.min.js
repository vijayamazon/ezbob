(function(){var n,t=function(n,t){return function(){return n.apply(t,arguments)}},i={}.hasOwnProperty,r=function(n,t){function u(){this.constructor=n}for(var r in t)i.call(t,r)&&(n[r]=t[r]);return u.prototype=t.prototype,n.prototype=new u,n.__super__=t.prototype,n};n=typeof exports!="undefined"&&exports!==null?exports:this;n.EzBob=n.EzBob||{};EzBob.ResetPasswordView=function(n){function i(){return this.focusCaptcha=t(this.focusCaptcha,this),this.focusAnswer=t(this.focusAnswer,this),this.focusEmail=t(this.focusEmail,this),i.__super__.constructor.apply(this,arguments)}return r(i,n),i.prototype.template="#restore-pass-template",i.prototype.initialize=function(){return this.mail=void 0,this.answerEnabled=!0,this.emailEnabled=!1,this.captchaEnabled=EzBob.Config.CaptchaMode==="off"},i.prototype.focus=null,i.prototype.ui={questionArea:"#questionArea",questionField:"#questionField",email:"#email",form:"form",getQuestionBtn:"#getQuestion",restoreBtn:"#restore",passwordRestoredArea:".passwordRestoredArea",restorePasswordArea:".restorePasswordArea",answer:"#Answer",captcha:"#CaptchaInputText"},i.prototype.onRender=function(){var n;return this.captcha=new EzBob.Captcha({elementId:"captcha",tabindex:11}),this.captcha.render(),this.ui.email.data("changed",!0),this.validator=EzBob.validateRestorePasswordForm(this.ui.form),this.initStatusIcons(),$("#email").focus(),EzBob.UiAction.registerView(this),n=new EzBob.NotificationsView({el:this.$el.find(".errorArea")}),n.render(),this},i.prototype.events={"click #getQuestion":"getQuestionBtnClicked","click #restore":"restoreClicked","keyup #email":"inputEmailChanged","change #email":"inputEmailChanged","keyup #Answer":"inputAnswerChanged","change #Answer":"inputAnswerChanged","keyup #CaptchaInputText":"inputCaptchaChanged","change #CaptchaInputText":"inputCaptchaChanged"},i.prototype.restoreClicked=function(n){var i,t=this;return this.ui.restoreBtn.hasClass("disabled")?!1:(i=$(n.currentTarget),i.hasClass("disabled"))?!1:(i.addClass("disabled"),this.focus=null,$.post("RestorePassword",this.ui.form.serializeArray()).done(function(n){return!EzBob.isNullOrEmpty(n.errorMessage)||!EzBob.isNullOrEmpty(n.error)?(EzBob.App.trigger("error",n.errorMessage||n.error),t.ui.questionArea.hide(),t.ui.email.closest("div").show(),$("#captcha").show(),t.focus=t.focusCaptcha,t.ui.answer.val(""),t.ui.getQuestionBtn.addClass("disabled"),!1):(t.ui.passwordRestoredArea.show(),t.ui.restorePasswordArea.hide(),scrollTop())}).fail(function(n){return EzBob.App.trigger("error",n.responceText),t.initStatusIcons(),t.focus=t.focusCaptcha}).always(function(){return t.ui.email.data("changed",!1),t.emailKeyuped(),t.captcha.reload(t.focus)}))},i.prototype.focusEmail=function(){return $("#email").focus()},i.prototype.focusAnswer=function(){return $("#Answer").focus()},i.prototype.focusCaptcha=function(){return $("#CaptchaInputText").focus()},i.prototype.inputCaptchaChanged=function(){var n;return this.captchaEnabled=this.validator.check($(this.ui.captcha.selector)),n=this.answerEnabled&&this.emailEnabled&&this.captchaEnabled,this.ui.getQuestionBtn.toggleClass("disabled",!n)},i.prototype.inputEmailChanged=function(){var n;return this.emailEnabled=this.validator.check(this.ui.email),n=this.answerEnabled&&this.emailEnabled&&this.captchaEnabled,this.ui.getQuestionBtn.toggleClass("disabled",!n)},i.prototype.inputAnswerChanged=function(){var n;return this.answerEnabled=this.validator.check(this.ui.answer),n=this.answerEnabled&&this.emailEnabled&&this.captchaEnabled,this.ui.restoreBtn.toggleClass("disabled",!n)},i.prototype.emailKeyuped=function(){return this.ui.email.data("changed")?!1:(this.ui.email.data("changed",!0),this.ui.questionArea.hide(),this.ui.getQuestionBtn.show(),this.captcha.$el.closest(".control-group").insertAfter(this.ui.email.closest(".control-group")))},i.prototype.getQuestionBtnClicked=function(){var n=this;return this.ui.getQuestionBtn.hasClass("disabled")?!1:(this.mail=this.ui.email.val(),EzBob.App.trigger("clear"),this.ui.questionArea.hide(),this.focus=null,$.post("QuestionForEmail",this.ui.form.serialize()).done(function(t){return t.broker?(document.location.href=""+window.gRootPath+"Broker#ForgotPassword",!0):!EzBob.isNullOrEmpty(t.errorMessage)||!EzBob.isNullOrEmpty(t.error)?(EzBob.App.trigger("error",t.errorMessage||t.error),n.ui.questionArea.hide(),n.focus=n.focusCaptcha,n.ui.getQuestionBtn.addClass("disabled"),!0):EzBob.isNullOrEmpty(t.question)?(EzBob.App.trigger("warning","To recover your password security question fields must be completely filled in the account settings"),n.ui.questionArea.hide(),n.focus=n.focusEmail,!0):(n.ui.questionField.text(t.question),n.ui.questionArea.show(),n.initStatusIcons("email"),n.ui.getQuestionBtn.hide(),n.captcha.$el.closest(".control-group").insertAfter(n.ui.answer.closest(".control-group")),n.ui.email.data("changed",!1),n.answerEnabled=!1,n.ui.email.closest("div").hide(),$("#captcha").hide(),$("#Answer").focus(),n.focus=n.focusAnswer)}).always(function(){return n.captcha.reload(n.focus)}))},i.prototype.initStatusIcons=function(n){var t;return t=this.$el.find("IMG.field_status"),t.filter(".required").field_status({required:!0}),t.not(".required").field_status({required:!1}),n==="email"?this.ui.email.change():void 0},i}(Backbone.Marionette.ItemView)}).call(this)