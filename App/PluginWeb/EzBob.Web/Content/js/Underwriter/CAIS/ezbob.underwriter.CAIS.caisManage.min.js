(function(){var t,i={}.hasOwnProperty,n=function(n,t){function u(){this.constructor=n}for(var r in t)i.call(t,r)&&(n[r]=t[r]);return u.prototype=t.prototype,n.prototype=new u,n.__super__=t.prototype,n};t=typeof exports!="undefined"&&exports!==null?exports:this;t.EzBob=t.EzBob||{};EzBob.Underwriter=EzBob.Underwriter||{};EzBob.Underwriter.CAIS=EzBob.Underwriter.CAIS||{};EzBob.Underwriter.CAIS.ListOfFilesModel=function(t){function i(){return i.__super__.constructor.apply(this,arguments)}return n(i,t),i.prototype.url=""+gRootPath+"Underwriter/CAIS/ListOfFiles",i.prototype["default"]={cais:{}},i.prototype.initialize=function(){var n,t=this;return n=setInterval(function(){return t.fetch()},2e3),this.set("interval",n)},i}(Backbone.Model);EzBob.Underwriter.CAIS.SelectedFile=function(t){function i(){return i.__super__.constructor.apply(this,arguments)}return n(i,t),i.prototype["default"]={id:""},i}(Backbone.Model);EzBob.Underwriter.CAIS.SelectedFiles=function(t){function i(){return i.__super__.constructor.apply(this,arguments)}return n(i,t),i.prototype.model=EzBob.Underwriter.CAIS.SelectedFile,i.prototype.getModelById=function(n){return this.filter(function(t){return t.get("id")===n})},i}(Backbone.Collection);EzBob.Underwriter.CAIS.CaisManageView=function(t){function i(){return i.__super__.constructor.apply(this,arguments)}return n(i,t),i.prototype.template=_.template($("#cais-template").length>0?$("#cais-template").html():""),i.prototype.initialize=function(){var n=this;return this.model=new EzBob.Underwriter.CAIS.ListOfFilesModel,this.bindTo(this.model,"change reset",this.render,this),BlockUi("on"),this.model.fetch().done(function(){return BlockUi("off")}),this.checkedModel=new EzBob.Underwriter.CAIS.SelectedFiles,this.bindTo(this.checkedModel,"add remove reset",this.checkedFileModelChanged,this)},i.prototype.ui={count:".reports-count",download:".download"},i.prototype.onRender=function(){return this.checkedFileModelChanged()},i.prototype.serializeData=function(){return{model:this.model.get("cais"),checkedModel:this.checkedModel.toJSON()}},i.prototype.checkedFileModelChanged=function(){return this.checkedModel.length===0?this.ui.download.hide():(this.ui.download.show(),this.ui.count.text(this.checkedModel.length))},i.prototype.events={"click .generate":"generateClicked","click .download ":"downloadFile","dblclick [data-id]":"fileSelected","click [data-id]":"fileChecked"},i.prototype.downloadFile=function(){return _.each(this.checkedModel.toJSON(),function(n){return window.open(""+gRootPath+"Underwriter/CAIS/DownloadFile?Id="+n.id,"_blank")})},i.prototype.fileViewChanged=function(n){var t;return t=$(n.currentTarget),$(".save-change").removeClass("disabled"),t.css("border","1px solid lightgreen")},i.prototype.resetFileView=function(){return $("textarea").css("border","1px solid #cccccc"),$(".save-change").addClass("disabled")},i.prototype.fileChecked=function(n){var t,i,r;if(!(_.keys($(n.target).data()).length>0))return t=$(n.currentTarget),i=t.hasClass("checked"),r=t.data("id"),t.toggleClass("checked",!i),i?this.checkedModel.remove(this.checkedModel.getModelById(r)):this.checkedModel.add(new EzBob.Underwriter.CAIS.SelectedFile({id:r}))},i.prototype.generateClicked=function(n){var t;if(t=$(n.currentTarget),!t.hasClass("disabled"))return t.addClass("disabled"),$.post(gRootPath+"Underwriter/CAIS/Generate").done(function(n){if(n.error!==void 0){EzBob.ShowMessage("Something went wrong","Error occured");return}return EzBob.ShowMessage("Generating current CAIS reports. Please wait few minutes.","Successful")}).always(function(){return t.removeClass("disabled")})},i.prototype.fileSelected=function(n){var r,t,i,u=this;return i=this,r=$(n.currentTarget),t=r.data("id"),BlockUi("on"),$.get(""+gRootPath+"Underwriter/CAIS/GetOneFile",{id:t}).done(function(n){var r;if(n.error){EzBob.ShowMessage(n.error,"Error");return}r=$("<div/>").html("<textarea wrap='off' class='cais-file-view'>"+n+"<\/textarea>");r.dialog({title:t,width:"75%",height:600,modal:!0,draggable:!1,resizable:!1,buttons:[{text:"Save file changes",click:function(n){return i.saveFileChange(n)},"class":"btn btn-primary save-change disabled","data-id":t},{html:"<i class='fa fa-refresh'><\/i>Set Status Uploaded",click:function(n){return i.fileUploaded(n)},"class":"btn btn-primary save-change","data-id":t},{text:"Close",click:function(){return r.dialog("destroy")},"class":"btn btn-primary"}]});return r.find(".cais-file-view").on("keypress keyup keydown",u.fileViewChanged)}).always(function(){return BlockUi("off")})},i.prototype.fileUploaded=function(n){var i,r,u,t;return u=this,i=$(n.currentTarget),r=i.data("id"),BlockUi("on"),t=$.post(""+gRootPath+"CAIS/UpdateStatus",{id:r}),t.done(function(n){return n.error?(EzBob.ShowMessage(n.error,"Something went wrong"),!1):(EzBob.ShowMessage("Status Updated ","Successful"),u.resetFileView())}),t.fail(function(){return EzBob.ShowMessage("Error occured","Something went wrong")}),t.always(function(){return BlockUi("off")})},i.prototype.saveFileChange=function(n){var r,t,u,i,f,e;if(e=this,t=$(n.currentTarget),!t.hasClass("disabled"))return r=$("textarea:visible"),u=r.val(),i=t.data("id"),f=function(){var n;return BlockUi("on"),n=$.post(""+gRootPath+"CAIS/SaveFileChange",{fileContent:u,id:i}),n.done(function(n){return n.error?(EzBob.ShowMessage(n.error,"Something went wrong"),!1):(EzBob.ShowMessage("File #"+i+" successfully saved ","Successful"),e.resetFileView())}),n.fail(function(){return EzBob.ShowMessage("Error occured","Something went wrong")}),n.always(function(){return BlockUi("off")})},EzBob.ShowMessage("Are you sure you want to save the change?","Confirmation",f,"Save",null,"Cancel")},i}(Backbone.Marionette.ItemView)}).call(this)