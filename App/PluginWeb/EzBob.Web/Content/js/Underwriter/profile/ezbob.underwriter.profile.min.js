(function(){var n,t={}.hasOwnProperty,i=function(n,i){function u(){this.constructor=n}for(var r in i)t.call(i,r)&&(n[r]=i[r]);return u.prototype=i.prototype,n.prototype=new u,n.__super__=i.prototype,n};n=typeof exports!="undefined"&&exports!==null?exports:this;n.EzBob=n.EzBob||{};EzBob.Underwriter.ProfileView=function(n){function t(){return t.__super__.constructor.apply(this,arguments)}return i(t,n),t.prototype.initialize=function(){return this.template=_.template($("#profile-template-main").html())},t.prototype.render=function(){var p,t,i,r,u,f,e,o,s,h,c,l,a,v,n,y=this;this.$el.html(this.template());a=this.$el.find(".profile-person-info");e=this.$el.find(".profile-loan-info");v=this.$el.find("#profile-summary");s=this.$el.find("#marketplaces");u=this.$el.find("#credit-bureau");l=this.$el.find("#payment-accounts");o=this.$el.find("#loanhistorys");h=this.$el.find("#medal-calculator");c=this.$el.find("#messages");t=this.$el.find("#apiChecks");r=this.$el.find("#customerRelations");p=this.$el.find("#alerts-passed");i=this.$el.find("#controlButtons");f=this.$el.find("#fraudDetection");this.personalInfoModel=new EzBob.Underwriter.PersonalInfoModel;this.profileInfoView=new EzBob.Underwriter.PersonInfoView({el:a,model:this.personalInfoModel});this.personalInfoModel.on("change",this.changeDecisionButtonsState,this);this.marketPlaces=new EzBob.Underwriter.MarketPlaces;this.marketPlaceView=new EzBob.Underwriter.MarketPlacesView({el:s,model:this.marketPlaces,personalInfoModel:this.personalInfoModel});n=this;this.marketPlaceView.on("rechecked",this.mpRechecked,this.marketPlaces);EzBob.App.vent.on("ct:marketplaces.history",function(t){return n.show(n.marketPlaces.customerId,!0,t)});this.loanHistory=new EzBob.Underwriter.LoanHistoryModel;this.loanHistoryView=new EzBob.Underwriter.LoanHistoryView({el:o,model:this.loanHistory});this.experianInfoModel=new EzBob.Underwriter.ExperianInfoModel;this.experianInfoView=new EzBob.Underwriter.ExperianInfoView({el:u,model:this.experianInfoModel});this.loanInfoModel=new EzBob.Underwriter.LoanInfoModel;this.loanInfoView=new EzBob.Underwriter.LoanInfoView({el:e,model:this.loanInfoModel,personalInfo:this.personalInfoModel,parentView:this});this.summaryInfoModel=new EzBob.Underwriter.SummaryInfoModel;this.summaryInfoView=new EzBob.Underwriter.SummaryInfoView({el:v,model:this.summaryInfoModel});EzBob.App.vent.on("newCreditLine:done",function(){return y.summaryInfoModel.fetch()});EzBob.App.vent.on("newCreditLine:pass",function(){return y.summaryInfoModel.fetch()});this.paymentAccountsModel=new EzBob.Underwriter.PaymentAccountsModel;this.paymentAccountsView=new EzBob.Underwriter.PaymentAccountView({el:l,model:this.paymentAccountsModel});this.paymentAccountsView.on("rechecked",this.mpRechecked,this.paymentAccountsModel);this.medalCalculationModel=new EzBob.Underwriter.MedalCalculationModel;this.medalCalculationView=new EzBob.Underwriter.MedalCalculationView({el:h,model:this.medalCalculationModel});this.companyScoreModel=new EzBob.Underwriter.CompanyScoreModel;this.companyScoreView=new EzBob.Underwriter.CompanyScoreView({el:n.$el.find("#company-score-list"),model:this.companyScoreModel});n.$el.find("a.company-score-tab").on("shown.bs.tab",function(){return n.companyScoreView.showAccordion()});this.crossCheckView=new EzBob.Underwriter.CrossCheckView({el:this.$el.find("#customer-info")});this.messagesModel=new EzBob.Underwriter.MessageModel;this.Message=new EzBob.Underwriter.Message({el:c,model:this.messagesModel});this.Message.on("creditResultChanged",this.changedSystemDecision,this);return this.alertDocs=new EzBob.Underwriter.Docs,this.alertDocsView=new EzBob.Underwriter.AlertDocsView({el:this.$el.find("#alert-docs"),model:this.alertDocs}),this.ApicCheckLogs=new EzBob.Underwriter.ApiChecksLogs,this.ApiChecksLogView=new EzBob.Underwriter.ApiChecksLogView({el:t,model:this.ApicCheckLogs}),this.CustomerRelationsData=new EzBob.Underwriter.CustomerRelationsData,this.CustomerRelationsView=new EzBob.Underwriter.CustomerRelationsView({el:r,model:this.CustomerRelationsData}),this.FraudDetectionLogs=new EzBob.Underwriter.fraudDetectionLogModel,this.FraudDetectionLogView=new EzBob.Underwriter.FraudDetectionLogView({el:f,model:this.FraudDetectionLogs}),this.showed=!0,this.controlButtons=new EzBob.Underwriter.ControlButtonsView({el:i}),EzBob.handleUserLayoutSetting(),this},t.prototype.events={"click #RejectBtn":"RejectBtnClick","click #ApproveBtn":"ApproveBtnClick","click #EscalateBtn":"EscalateBtnClick","click #SuspendBtn":"SuspendBtnClick","click #ReturnBtn":"ReturnBtnClick"},t.prototype.recordRecentCustomers=function(n){var t;return t=$.post(""+gRootPath+"Underwriter/Customers/SetRecentCustomer",{id:n}),t.done(function(n){return localStorage.setItem("RecentCustomers",JSON.stringify(n.RecentCustomers))})},t.prototype.checkCustomerAvailability=function(n){var t;return t=n.toJSON(),t.success===!1?(EzBob.ShowMessage(t.error,"Error",function(){return Redirect("#")},"OK"),!1):(this.showed&&this.$el.show(),$('.tabbable a[href="#profile-summary"]').tab("show"))},t.prototype.mpRechecked=function(n){var t,i;return t=this,i=n.umi,t.fetch().done(function(){var r,u;return r=$("#"+n.el.attr("id")),r.addClass("disabled"),u=setInterval(function(){var n;return n=$.get(window.gRootPath+"Underwriter/MarketPlaces/CheckForUpdatedStatus",{mpId:i}),n.done(function(n){if(n.status!=="In progress")return clearInterval(u),t.fetch().done(function(){return r.removeClass("disabled")})})},1e3)})},t.prototype.disableChange=function(n){return this.show(n,!1)},t.prototype.RejectBtnClick=function(n){var t;if($(n.currentTarget).hasClass("disabled"))return!1;t=new EzBob.Underwriter.RejectedDialog({model:this.loanInfoModel});t.render();t.on("changedSystemDecision",this.changedSystemDecision,this);return!1},t.prototype.ApproveBtnClick=function(n){var t;return $(n.currentTarget).hasClass("disabled")?!1:this.loanInfoModel.get("InterestRate")<=0?(EzBob.ShowMessage("Wrong Interest Rate value ("+this.loanInfoModel.get("InterestRate")+"), please enter the valid value (above zero)","Error"),!1):this.loanInfoModel.get("OfferedCreditLine")<=0?(EzBob.ShowMessage("Wrong Offered credit line value ("+this.loanInfoModel.get("OfferedCreditLine")+"), please enter the valid value (above zero)","Error"),!1):this.loanInfoModel.get("OfferExpired")?(EzBob.ShowMessage("Loan offer has expired. Set new validity date.","Error"),!1):(this.skipPopupForApprovalWithoutAML=this.loanInfoModel.get("SkipPopupForApprovalWithoutAML"),this.loanInfoModel.get("AMLResult")!=="Passed"&&!this.skipPopupForApprovalWithoutAML)?(t=new EzBob.Underwriter.ApproveLoanWithoutAML({model:this.loanInfoModel,parent:this,skipPopupForApprovalWithoutAML:this.skipPopupForApprovalWithoutAML}),EzBob.App.jqmodal.show(t),!1):this.CheckCustomerStatusAndCreateApproveDialog()},t.prototype.CheckCustomerStatusAndCreateApproveDialog=function(){var n;return this.personalInfoModel.get("IsWarning")?(n=new EzBob.Underwriter.ApproveLoanForWarningStatusCustomer({model:this.personalInfoModel,parent:this}),EzBob.App.jqmodal.show(n),!1):this.CreateApproveDialog()},t.prototype.CreateApproveDialog=function(){var n=new EzBob.Underwriter.ApproveDialog({model:this.loanInfoModel});n.on("changedSystemDecision",this.changedSystemDecision,this);return n.render(),!1},t.prototype.EscalateBtnClick=function(n){var t;if($(n.currentTarget).hasClass("disabled"))return!1;t=new EzBob.Underwriter.Escalated({model:this.loanInfoModel});t.render();t.on("changedSystemDecision",this.changedSystemDecision,this);return!1},t.prototype.SuspendBtnClick=function(n){var t;if($(n.currentTarget).hasClass("disabled"))return!1;t=new EzBob.Underwriter.Suspended({model:this.loanInfoModel});t.render();t.on("changedSystemDecision",this.changedSystemDecision,this);return!1},t.prototype.ReturnBtnClick=function(n){var t;if($(n.currentTarget).hasClass("disabled"))return!1;t=new EzBob.Underwriter.Returned({model:this.loanInfoModel});t.render();t.on("changedSystemDecision",this.changedSystemDecision,this);return!1},t.prototype.changedSystemDecision=function(){return this.summaryInfoModel.fetch(),this.personalInfoModel.fetch(),this.loanInfoModel.fetch(),this.loanHistory.fetch(),this.changeDecisionButtonsState()},t.prototype.show=function(n,t,i){var u,f,e,r=this;return this.hide(),BlockUi("on"),scrollTop(),f=this,this.companyScoreView.hideAccordion(),this.customerId=n,u=new EzBob.Underwriter.CustomerFullModel({customerId:n,history:(e=EzBob.parseDate(i))!=null?e:{history:null}}),u.fetch().done(function(){switch(u.get("State")){case"NotFound":EzBob.ShowMessage(res.error,"Customer id. #"+n+" was not found");r.router.navigate("",{trigger:!0,replace:!0});return;case"NotSuccesfullyRegistred":r.trigger("customerNotFull",n);return}return r.personalInfoModel.set({Id:n},{silent:!0}),r.personalInfoModel.set(u.get("PersonalInfoModel"),{silent:!0}),r.personalInfoModel.changeDisabled(!0),r.changeDecisionButtonsState(r.personalInfoModel.get("Editable")),r.personalInfoModel.trigger("sync"),r.loanInfoModel.set({Id:n},{silent:!0}),r.loanInfoModel.set(u.get("ApplicationInfoModel"),{silent:!0}),r.loanInfoModel.trigger("sync"),r.marketPlaces.customerId=n,r.marketPlaces.history=i,r.marketPlaces.reset(u.get("Marketplaces"),{silent:!0}),r.marketPlaces.trigger("sync"),r.loanHistory.customerId=n,r.loanHistoryView.idCustomer=n,r.loanHistory.set(u.get("LoansAndOffers"),{silent:!0}),r.loanHistory.trigger("sync"),r.summaryInfoModel.set({Id:n,success:!0},{silent:!0}),r.summaryInfoModel.set(u.get("SummaryModel"),{silent:!0}),r.summaryInfoModel.trigger("sync"),r.checkCustomerAvailability(r.summaryInfoModel),r.recordRecentCustomers(n),EzBob.UpdateBugsIcons(u.get("Bugs")),f.$el.find(".vsplitbar").length===0&&$("#spl").splitter({minLeft:280,sizeLeft:300,minRight:600}),r.experianInfoModel.set({Id:n},{silent:!0}),r.experianInfoModel.set(u.get("CreditBureauModel"),{silent:!0}),r.experianInfoModel.trigger("sync"),r.paymentAccountsModel.customerId=n,r.paymentAccountsModel.set(u.get("PaymentAccountModel"),{silent:!0}),r.paymentAccountsModel.trigger("sync"),r.medalCalculationModel.set({Id:n},{silent:!0}),r.medalCalculationModel.set(u.get("MedalCalculations"),{silent:!0}),r.medalCalculationModel.trigger("sync"),r.FraudDetectionLogs.customerId=n,r.FraudDetectionLogView.customerId=n,r.FraudDetectionLogs.set(u.get("FraudDetectionLog"),{silent:!0}),r.FraudDetectionLogs.trigger("sync"),r.ApicCheckLogs.customerId=n,r.ApiChecksLogView.idCustomer=n,r.ApicCheckLogs.reset(u.get("ApiCheckLogs"),{silent:!0}),r.ApicCheckLogs.trigger("sync"),r.messagesModel.set({Id:n},{silent:!0}),r.messagesModel.set({attaches:u.get("Messages"),silent:!0}),r.messagesModel.trigger("sync"),r.CustomerRelationsData.customerId=n,r.CustomerRelationsView.idCustomer=n,r.CustomerRelationsData.reset(u.get("CustomerRelations"),{silent:!0}),r.CustomerRelationsData.trigger("sync"),r.alertDocs.reset(u.get("AlertDocs"),{silent:!0}),r.alertDocsView.create(n),r.alertDocs.trigger("sync"),r.companyScoreModel.customerId=n,r.companyScoreModel.set(u.get("CompanyScore"),{silent:!0}),r.companyScoreModel.trigger("sync"),r.crossCheckView.segmentType=u.get("PersonalInfoModel").SegmentType,r.crossCheckView.marketPlaces=r.marketPlaces,r.crossCheckView.companyScore=r.companyScoreModel,r.crossCheckView.experianDirectors=u.get("ExperianDirectors"),r.crossCheckView.fullModel=u,r.crossCheckView.render({customerId:n}),t&&$("a[href=#marketplaces]").click(),BlockUi("Off")}),this.controlButtons.model=new Backbone.Model({customerId:n}),this.controlButtons.render()},t.prototype.hide=function(){return this.$el.hide()},t.prototype.changeDecisionButtonsState=function(n){var t,i;i=this.personalInfoModel.get("Disabled")===1;t=this.personalInfoModel.get("CreditResult");this.$el.find("#SuspendBtn, #RejectBtn, #ApproveBtn, #EscalateBtn, #ReturnBtn").toggleClass("disabled",i);n&&this.$el.find("#SuspendBtn, #RejectBtn, #ApproveBtn, #EscalateBtn, #ReturnBtn").hide();switch(t){case"WaitingForDecision":if(this.$el.find("#ReturnBtn").hide(),this.$el.find("#RejectBtn").show(),this.$el.find("#ApproveBtn").show(),this.$el.find("#SuspendBtn").show(),!escalatedFlag)return this.$el.find("#EscalateBtn").show();break;case"Rejected":case"Approved":case"Late":return this.$el.find("#ReturnBtn").hide(),this.$el.find("#RejectBtn").hide(),this.$el.find("#ApproveBtn").hide(),this.$el.find("#SuspendBtn").hide(),this.$el.find("#EscalateBtn").hide();case"Escalated":return this.$el.find("#ReturnBtn").hide(),this.$el.find("#RejectBtn").show(),this.$el.find("#ApproveBtn").show(),this.$el.find("#SuspendBtn").show(),this.$el.find("#EscalateBtn").hide();case"ApprovedPending":return this.$el.find("#ReturnBtn").show(),this.$el.find("#RejectBtn").hide(),this.$el.find("#ApproveBtn").hide(),this.$el.find("#SuspendBtn").hide(),this.$el.find("#EscalateBtn").hide()}},t.prototype.updateAlerts=function(){return this.alertsModel.fetch()},t.prototype.clearDecisionNotes=function(){return this.$el.find("#DecisionNotes").empty()},t.prototype.appendDecisionNote=function(n){return this.$el.find("#DecisionNotes").append(n)},t}(Backbone.View)}).call(this)