(function(){var n,i={}.hasOwnProperty,t=function(n,t){function u(){this.constructor=n}for(var r in t)i.call(t,r)&&(n[r]=t[r]);return u.prototype=t.prototype,n.prototype=new u,n.__super__=t.prototype,n};n=typeof exports!="undefined"&&exports!==null?exports:this;n.EzBob=n.EzBob||{};EzBob.Underwriter=EzBob.Underwriter||{};EzBob.Underwriter.LoanHistoryDetailsModel=function(n){function i(){return i.__super__.constructor.apply(this,arguments)}return t(i,n),i.prototype.url=function(){return""+window.gRootPath+"Underwriter/LoanHistory/Details?customerid="+this.id+"&loanid="+this.loanid},i}(Backbone.Model);EzBob.Underwriter.LoanDetailsView=function(n){function i(){return i.__super__.constructor.apply(this,arguments)}return t(i,n),i.prototype.initialize=function(){return this.template=_.template($("#loan-details-template").html()),this.bindTo(this.model,"change reset",this.render,this)},i.prototype.attributes={"class":"underwriter-loan-details"},i.prototype.render=function(){var n;return n=this,this.$el.dialog({modal:!0,resizable:!0,title:"Loan Details - "+this.options.loan.RefNumber,position:"center",draggable:!0,width:"1000",height:"900",close:function(){return $(this).dialog("destroy"),n.trigger("close")}}),this.renderContent(),this},i.prototype.renderContent=function(){var n,t,i;return i=this.options.loan,t=this.model.toJSON(),n=t.details,this.$el.html(this.template({loan:i,transactions:n&&n.Transactions,schedule:n&&n.Schedule,pacnetTransactions:n&&n.PacnetTransactions,area:"Underwriter",rollovers:n&&n.Rollovers,charges:n&&n.Charges,showFailed:this.$el.find(".filter-errors").is(":checked"),rolloverCount:t.rolloverCount})),i.Modified?this.$el.find(".offer-status").append("<strong>Loan was manually modified<\/strong>").css({"margin-top":"-20px"}):void 0},i.prototype.events={"click .rollover":"rollover","click .make-payment":"makePayment","click #btn-options":"showDialogOptions","change .filter-errors":"renderContent","click .pdf-link":"exportToPdf","click .excel-link":"exportToExcel"},i.prototype.rollover=function(){var n;if(!this.checkForActiveLoan())return!1;if(this.model.get("notExperiedRollover")&&this.model.get("notExperiedRollover").PaidPaymentAmount>0)return EzBob.ShowMessage("Rollover is partially paid. Cannot be edited."),!1;n={schedule:this.model.get("details").Schedule,rollover:this.model.get("details").Rollovers,configValues:this.model.get("configValues"),notExperiedRollover:this.model.get("notExperiedRollover"),loanId:this.model.loanid};this.rolloverView=new EzBob.Underwriter.RolloverView({model:n});EzBob.App.jqmodal.show(this.rolloverView);this.rolloverView.on("addRollover",this.addRollover,this);return this.rolloverView.on("removeRollover",this.removeRollover,this)},i.prototype.removeRollover=function(n){var t;return t=this,BlockUi("on"),$.post(window.gRootPath+"Underwriter/LoanHistory/RemoveRollover",n).success(function(n){if(n.success===!1){EzBob.ShowMessage(n.error,"Something went wrong");return}return EzBob.ShowMessage("Rollover succesfully removed"),t.model.fetch()}).done(function(){return EzBob.App.jqmodal.hideModal(t.rolloverView),BlockUi("off")})},i.prototype.addRollover=function(n){var t;return t=this,BlockUi("on"),$.post(window.gRootPath+"Underwriter/LoanHistory/AddRollover",n).success(function(i){if(i.success===!1){EzBob.ShowMessage(i.error,"Something went wrong");return}return EzBob.ShowMessage("Rollover succesfully "+(SerializeArrayToEasyObject(n).isEditCurrent==="true"?"edited":"added")),t.model.fetch(),t.trigger("RolloverAdded")}).done(function(){return EzBob.App.jqmodal.hideModal(t.rolloverView),BlockUi("off")})},i.prototype.makePayment=function(){var t,n;t={loanId:this.options.loan.Id};n=new EzBob.Underwriter.ManualPaymentView({model:new Backbone.Model(t)});EzBob.App.jqmodal.show(n);return n.on("addPayment",this.addPayment,this)},i.prototype.addPayment=function(n){var t;return t=this,n+="&CustomerId="+this.model.id,n+="&LoanId="+this.options.loan.Id,BlockUi("on"),$.post(window.gRootPath+"Underwriter/LoanHistory/ManualPayment",n).success(function(n){return n.error?EzBob.ShowMessage(n.error,"Something went wrong",function(){}):EzBob.ShowMessage("Manual payment succesfully added","",function(){return t.model.fetch(),t.trigger("ManualPaymentAdded"),!0})}).done(function(){return BlockUi("off")})},i.prototype.showDialogOptions=function(){var n,t;return this.loanOptionsModel=new EzBob.Underwriter.LoanOptionsModel,this.loanOptionsModel.loanId=this.model.loanid,t=this.loanOptionsModel.fetch(),n=this,t.done(function(){return this.optionsView=new EzBob.Underwriter.LoanOptionsView({model:n.loanOptionsModel}),this.optionsView.render(),EzBob.App.jqmodal.show(this.optionsView)})},i.prototype.checkForActiveLoan=function(){return this.options.loan.Status==="PaidOff"?(EzBob.ShowMessage("Loan is  paid off","Info"),!1):!0},i.prototype.exportToPdf=function(n){var t,i;return i=this.model.id,t=$(n.currentTarget),t.attr("href",window.gRootPath+"Underwriter/LoanHistory/ExportDetails?id="+i+"&loanid="+this.options.loan.Id+"&isExcel=false&wError="+this.$el.find(".filter-errors").is(":checked"))},i.prototype.exportToExcel=function(n){var t,i;return i=this.model.id,t=$(n.currentTarget),t.attr("href",window.gRootPath+"Underwriter/LoanHistory/ExportDetails?id="+i+"&loanid="+this.options.loan.Id+"&isExcel=true&wError="+this.$el.find(".filter-errors").is(":checked"))},i}(Backbone.Marionette.View)}).call(this)