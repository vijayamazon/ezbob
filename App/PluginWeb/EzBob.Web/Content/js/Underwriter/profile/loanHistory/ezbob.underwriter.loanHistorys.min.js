(function(){var n,i={}.hasOwnProperty,t=function(n,t){function u(){this.constructor=n}for(var r in t)i.call(t,r)&&(n[r]=t[r]);return u.prototype=t.prototype,n.prototype=new u,n.__super__=t.prototype,n};n=typeof exports!="undefined"&&exports!==null?exports:this,n.EzBob=n.EzBob||{},EzBob.Underwriter=EzBob.Underwriter||{},EzBob.Underwriter.LoanHistoryModel=function(n){function i(){return i.__super__.constructor.apply(this,arguments)}return t(i,n),i.prototype.idAttribute="Id",i.prototype.url=function(){return""+window.gRootPath+"Underwriter/LoanHistory/Index/"+this.customerId},i}(Backbone.Model),EzBob.Underwriter.LoanHistoryView=function(n){function i(){return i.__super__.constructor.apply(this,arguments)}return t(i,n),i.prototype.initialize=function(){return this.template=_.template($("#loanhistory-template").html()),this.templateView=_.template($("#loanhistory-view-template").html()),this.offersTemplate=_.template($("#offrers-template").html()),this.bindTo(this.model,"reset fetch change",this.render,this),this.isRejections=!0},i.prototype.events={"click tr.loans.tr-link":"rowClick","click .export-to-exel":"exportExcel","click .edit-loan":"editLoan","click .show-schedule":"showSchedule","click .show-rejections":"showRejections"},i.prototype.showRejections=function(){return this.isRejections=this.$el.find(".show-rejections").is(":checked"),this.renderOffers()},i.prototype.exportExcel=function(){return location.href=""+window.gRootPath+"Underwriter/LoanHistory/ExportToExel?id="+this.model.customerId},i.prototype.rowClick=function(n){var t,r,i,u;if(i=+n.currentTarget.getAttribute("data-id"),i!=null){t=new EzBob.Underwriter.LoanHistoryDetailsModel,t.loanid=i,u=_.find(this.model.get("loans"),function(n){return n.Id===i}),t.id=this.idCustomer,r=new EzBob.Underwriter.LoanDetailsView({model:t,loan:u});r.on("RolloverAdded",this.updateView,this);r.on("ManualPaymentAdded",this.updateView,this);return t.fetch()}},i.prototype.updateView=function(){return this.model.fetch()},i.prototype.editLoan=function(n){var i,t,r,u=this;return i=n.currentTarget.getAttribute("data-id"),t=new EzBob.LoanModel({Id:i}),r=t.fetch(),r.done(function(){var n=new EzBob.EditLoanView({model:t});n.on("item:saved",u.updateView,u);return EzBob.App.jqmodal.show(n)}),!1},i.prototype.render=function(){var n;return this.$el.html(this.templateView()),this.table=this.$el.find("#loanhistory-table"),n=this.model.toJSON(),this.table.html(this.template(n)),this.renderOffers(),this},i.prototype.renderOffers=function(){var n;return n={offers:this.filterOffers()},this.offersConteiner=this.$el.find("#offers-conteiner"),this.offersConteiner.html(this.offersTemplate(n)),this},i.prototype.filterOffers=function(){return this.isRejections?_.filter(this.model.get("offers"),function(n){return n.UnderwriterDecision==="Rejected"||n.UnderwriterDecision==="Approved"}):_.filter(this.model.get("offers"),function(n){return n.UnderwriterDecision==="Approved"})},i.prototype.showSchedule=function(n){var t,i,r=this;return t=$(n.currentTarget).data("id"),i=$.getJSON(""+window.gRootPath+"Underwriter/Schedule/Calculate/"+t),i.done(function(n){var i;return i=new EzBob.LoanScheduleViewDlg({schedule:n,isShowGift:!1,isShowExportBlock:!0,offerId:t,customerId:r.model.customerId}),EzBob.App.jqmodal.show(i)}),!1},i}(Backbone.Marionette.View)}).call(this)