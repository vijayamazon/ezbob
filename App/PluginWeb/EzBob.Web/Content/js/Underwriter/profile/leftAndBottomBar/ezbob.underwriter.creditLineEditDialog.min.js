(function(){var n,t={}.hasOwnProperty,i=function(n,i){function u(){this.constructor=n}for(var r in i)t.call(i,r)&&(n[r]=i[r]);return u.prototype=i.prototype,n.prototype=new u,n.__super__=i.prototype,n};n=typeof exports!="undefined"&&exports!==null?exports:this;n.EzBob=n.EzBob||{};EzBob.Underwriter=EzBob.Underwriter||{};EzBob.Underwriter.CreditLineEditDialog=function(n){function t(){return t.__super__.constructor.apply(this,arguments)}return i(t,n),t.prototype.template="#credit-line-edit-dialog-template",t.prototype.initialize=function(n){return this.model=n.model,this.modelBinder=new Backbone.ModelBinder,this.method=null,this.medal=null,this.value=null},t.prototype.events={"click .btnOk":"save","click .suggested-amount-link":"suggestedAmountClicked",keydown:"onEnterKeydown","change .percent":"percentChanged"},t.prototype.ui={form:"form",amount:"#edit-offer-amount"},t.prototype.jqoptions=function(){return{modal:!0,resizable:!0,title:"Offer credit line edit",position:"center",draggable:!0,dialogClass:"credit-line-edit-popup",width:800}},t.prototype.percentChanged=function(n){var i,u,f,t,r;return i=$(n.target),t=i.autoNumericGet()/100,f=i.data("method"),r=i.data("value"),u=this.$el.find("a.Manual"+f),u.text("Manual offer "+EzBob.formatPoundsNoDecimals(r*t)+" ("+EzBob.formatPercents(t)+")").data("value",r*t).data("percent",t)},t.prototype.onEnterKeydown=function(n){return n.keyCode===13?(this.ui.amount.change().blur(),this.save(),!1):!0},t.prototype.save=function(){var n,t=this;if(this.validator.checkForm())return n=$.post(""+window.gRootPath+"ApplicationInfo/ChangeCashRequestOpenCreditLine",this.getPostData()),n.done(function(){return t.model.fetch(),t.trigger("done")}),this.close()},t.prototype.suggestedAmountClicked=function(n){var t;return t=$(n.currentTarget),this.method=t.data("method"),this.medal=t.data("medal"),this.value=t.data("value"),this.percent=t.data("percent"),this.ui.amount.val(this.value).change().blur(),this.save(),!1},t.prototype.getPostData=function(){var n;return n=this.model.toJSON(),{id:n.CashRequestId,amount:n.amount,method:this.method,medal:this.medal,value:this.value,percent:this.percent}},t.prototype.bindings={amount:{selector:"#edit-offer-amount",converter:EzBob.BindingConverters.moneyFormat}},t.prototype.onRender=function(){return this.modelBinder.bind(this.model,this.el,this.bindings),this.$el.find("#edit-offer-amount").autoNumeric(EzBob.moneyFormat),this.$el.find(".percent").autoNumeric(EzBob.percentFormat).blur(),this.$el.find("#edit-offer-amount").val()==="-"&&this.$el.find("#edit-offer-amount").val(""),this.validator=this.setValidator()},t.prototype.serializeData=function(){return{m:this.model.toJSON()}},t.prototype.setValidator=function(){return this.ui.form.validate({rules:{editOfferAmount:{required:!0,autonumericMin:EzBob.Config.XMinLoan,autonumericMax:EzBob.Config.MaxLoan}},messages:{editOfferAmount:{autonumericMin:"Offer is below limit.",autonumericMax:"Offer is above limit."}},errorPlacement:EzBob.Validation.errorPlacement,unhighlight:EzBob.Validation.unhighlight})},t}(Backbone.Marionette.ItemView)}).call(this)