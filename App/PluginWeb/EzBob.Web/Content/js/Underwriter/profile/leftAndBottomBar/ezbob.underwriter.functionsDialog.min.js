(function(){var n;n=typeof exports!="undefined"&&exports!==null?exports:this,n.EzBob=n.EzBob||{},EzBob.Underwriter=EzBob.Underwriter||{},EzBob.Underwriter.FunctionsDialogView=Backbone.View.extend({initialize:function(){return this.template=_.template(this.getTemplate()),this.type=this.getType()},getTemplate:function(){return $("#functionsDialogTemplate").html()},getType:function(){return null},render:function(){var n;return this.$el.html(this.template(this.model)),n=this.getButtonName(),this.$el.find(".button-ok").val(n),this.ReasonField=this.$el.find(".reason"),this.YodleeReasonField=this.$el.find(".yodleeReason"),this.showReasonField()||(this.ReasonField.css("display","none"),this.$el.find("h3").css("display","none")),this.ReasonField.val(this.model.get("Reason")),this.$el.dialog({autoOpen:!0,position:["top",60],draggable:!0,title:"Are you sure?",modal:!0,resizable:!0,width:this.dlgWidth||520,height:this.dlgHeight||300,dialogClass:"functionsPopup",open:_.bind(this.onShow,this)}),this},getButtonName:function(){return"Ok"},showReasonField:function(){return!0},onShow:function(){},events:{"click .button-ok":"BtnOkClicked","click .button-cancel":"BtnCancelClicked","keydown textarea.reason":"TextAreaChanged","keydown textarea.yodleeReason":"TextAreaChanged"},ReasonFieldEmptyError:function(n,t){return t?n.css("border","1px solid red"):n.css("border","")},TextAreaChanged:function(n){return(this.getType()!=="Approved"||EzBob.isNullOrEmpty(this.model.get("OfferedCreditLine"))||this.model.get("OfferedCreditLine")!==0)&&$(".button-ok").removeClass("disabled"),this.ReasonFieldEmptyError($(n.currentTarget),!1)},BtnOkClicked:function(n){var i,t,r;return(r=this,$(n.currentTarget).hasClass("disabled"))?!1:($(n.currentTarget).addClass("disabled"),t=!1,this.ReasonField.val()===""&&this.showReasonField()&&(this.ReasonFieldEmptyError(this.ReasonField,!0),t=!0),this.YodleeReasonField.val()===""&&this.NoYodlee&&(this.ReasonFieldEmptyError(this.YodleeReasonField,!0),t=!0),t)?!1:(i={id:this.model.get("CustomerId"),status:this.type},this.showReasonField()&&(i.reason=this.ReasonField.val()),this.NoYodlee&&(i.reason+=" "+this.YodleeReasonField.val()),t=$.post(window.gRootPath+"Underwriter/Customers/ChangeStatus",i),BlockUi("on"),t.done(function(n){if(n.error){EzBob.ShowMessage(n.error,"Error occured"),r.$el.css("border","1px solid red");return}return r.$el.dialog("close"),r.trigger("changedSystemDecision"),$(".ui-icon-refresh").click()}),t.complete(function(){return BlockUi("off"),$(n.currentTarget).removeClass("disabled")}))},BtnCancelClicked:function(){return this.$el.dialog("close")}}),EzBob.Underwriter.RejectedDialog=EzBob.Underwriter.FunctionsDialogView.extend({getType:function(){return"Rejected"},getButtonName:function(){return"Reject"}}),EzBob.Underwriter.Escalated=EzBob.Underwriter.FunctionsDialogView.extend({getType:function(){return"Escalated"},getButtonName:function(){return"Escalate"}}),EzBob.Underwriter.Suspended=EzBob.Underwriter.FunctionsDialogView.extend({getType:function(){return"ApprovedPending"},getButtonName:function(){return"Suspend"},showReasonField:function(){return!1},dlgHeight:120,dlgWidth:300}),EzBob.Underwriter.Returned=EzBob.Underwriter.FunctionsDialogView.extend({getType:function(){return"WaitingForDecision"},getButtonName:function(){return"Return"},showReasonField:function(){return!1},dlgHeight:120,dlgWidth:300}),EzBob.Underwriter.ApproveDialog=EzBob.Underwriter.FunctionsDialogView.extend({events:function(){return _.extend({},EzBob.Underwriter.FunctionsDialogView.prototype.events,{"click .change-offer-details":"changeLoanDetails","click .pdf-link":"exportToPdf","click .excel-link":"exportToExcel"})},getType:function(){return"Approved"},showReasonField:function(){return!0},onShow:function(){var n;this.renderDetails(),this.renderSchedule();this.model.on("change",this.renderDetails,this);return this.model.get("OfferedCreditLine")&&this.model.get("OfferedCreditLine")!==0||this.$el.find(".button-ok").addClass("disabled"),this.model.get("OfferExpired")&&this.$el.find(".button-ok").addClass("disabled"),((n=this.model.get("IsLoanTypeSelectionAllowed"))===1||n==="1")&&this.$el.find(".change-offer-details").attr("disabled","disabled"),this.NoYodlee=this.model.get("IsOffline")&&!this.model.get("HasYodlee"),this.$el.find("#noYodleeReasonDiv").toggleClass("hide",!this.NoYodlee)},renderDetails:function(){var n;return n=_.template($("#approve-details").html(),this.model.toJSON()),this.$el.find("#details").html(n),this.model.get("IsModified")?this.$el.find(".offer-status").append("<strong>Offer was manually modified<\/strong>").css({"margin-top":"-20px"}):void 0},renderSchedule:function(){var n;return n=this,$.getJSON(window.gRootPath+"Underwriter/Schedule/Calculate",{id:this.model.get("CashRequestId")}).done(function(t){var i;return i=new EzBob.LoanScheduleView({el:n.$el.find(".loan-schedule"),schedule:t,isShowGift:!1,isShowExportBlock:!1}),i.render(),n.$el.find("#loan-schedule .simple-well").hide()})},getButtonName:function(){return"Approve"},dlgWidth:650,dlgHeight:750,onSaved:function(){var n;return n=this,this.renderSchedule(),$.post(window.gRootPath+"Underwriter/ApplicationInfo/IsLoanTypeSelectionAllowed",{id:this.model.get("CashRequestId"),loanTypeSelection:2}).done(function(){return n.model.fetch()})},changeLoanDetails:function(){var n,t,i;return t=this,n=new EzBob.LoanModelTemplate({CashRequestId:this.model.get("CashRequestId"),CustomerId:this.model.get("CustomerId")}),i=n.fetch(),i.done(function(){var i;i=new EzBob.EditLoanView({model:n}),EzBob.App.jqmodal.show(i);return i.on("item:saved",t.onSaved,t)}),!1},exportToPdf:function(n){var t;return t=$(n.currentTarget),t.attr("href",window.gRootPath+"Underwriter/Schedule/Export?id="+this.model.get("CashRequestId")+"&isExcel=false&isShowDetails=true&customerId="+this.model.get("CustomerId"))},exportToExcel:function(n){var t;return t=$(n.currentTarget),t.attr("href",window.gRootPath+"Underwriter/Schedule/Export?id="+this.model.get("CashRequestId")+"&isExcel=true&isShowDetails=true&customerId="+this.model.get("CustomerId"))}})}).call(this)