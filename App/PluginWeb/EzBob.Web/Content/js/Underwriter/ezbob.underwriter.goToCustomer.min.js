(function(){var n,i={}.hasOwnProperty,t=function(n,t){function u(){this.constructor=n}for(var r in t)i.call(t,r)&&(n[r]=t[r]);return u.prototype=t.prototype,n.prototype=new u,n.__super__=t.prototype,n};n=typeof exports!="undefined"&&exports!==null?exports:this;n.EzBob=n.EzBob||{};EzBob.Underwriter=EzBob.Underwriter||{};EzBob.Underwriter.RecentCustomersModel=function(n){function i(){return i.__super__.constructor.apply(this,arguments)}return t(i,n),i.prototype.url=window.gRootPath+"Underwriter/Customers/GetRecentCustomers",i}(Backbone.Model);EzBob.Underwriter.goToCustomerId=function(n){function i(){return i.__super__.constructor.apply(this,arguments)}return t(i,n),i.prototype.initialize=function(){var n=this;Mousetrap.bind("ctrl+g",function(){return n.render(),!1});return this.on("NotFound",this.notFound)},i.prototype.template=function(){var t,i,r,u,n,f;for(u=JSON.parse(localStorage.getItem("RecentCustomers")),t="",n=0,f=u.length;n<f;n++)i=u[n],t+='<option value="'+i.Item1+'">'+i.Item2+"<\/option>";return r=$("<div id='go-to-template'/>").html("            <input type='text' class='goto-customerId form-control' autocomplete='off'/>            <br/>            <label>Recent customers:<\/label>            <select id='recentCustomers'class='selectheight form-control'>"+t+"<\/select>            <br/>            <div class='error-place' style='color:red'><\/div>"),$("body").append(r),r},i.prototype.ui={input:".goto-customerId",select:"#recentCustomers",template:"#go-to-template",errorPlace:".error-place"},i.prototype.onRender=function(){var n=this;this.dialog=EzBob.ShowMessage(this.ui.template,"Customer ID?",function(){return n.okTrigger()},"OK",null,"Cancel");this.ui.input.on("keydown",function(t){return n.keydowned(t)});return this.okBtn=$(".ok-button"),this.ui.input.autocomplete({source:""+gRootPath+"Underwriter/Customers/FindCustomer",autoFocus:!0,minLength:3})},i.prototype.okTrigger=function(){var t,n;if(n=this.ui.input.val(),IsInt(n,!0)||(n=n.substring(0,n.indexOf(","))),!IsInt(n,!0)){if(t=this.ui.select.val(),!IsInt(t,!0))return this.addError("Incorrect input"),!1;n=t}return this.checkCustomer(n),!1},i.prototype.keydowned=function(n){if(this.addError(""),this.okBtn.attr("disabled")!=="disabled")return $(".ui-autocomplete:visible").length!==0?void 0:n.keyCode===13?this.okTrigger():void 0},i.prototype.addError=function(n){return this.ui.errorPlace.text(n)},i.prototype.checkCustomer=function(n){var i,t=this;return this.okBtn.attr("disabled","disabled"),i=$.get(""+window.gRootPath+"Underwriter/Customers/CheckCustomer?customerId="+n),i.done(function(i){switch(i.State){case"NotFound":t.addError("Customer id. #"+n+" was not found");break;case"NotSuccesfullyRegistred":t.addError("Customer id #"+n+" not successfully registered");break;case"Ok":t.trigger("ok",n);t.dialog.dialog("close")}}),i.complete(function(){return t.okBtn.removeAttr("disabled")})},i}(Backbone.Marionette.ItemView)}).call(this)