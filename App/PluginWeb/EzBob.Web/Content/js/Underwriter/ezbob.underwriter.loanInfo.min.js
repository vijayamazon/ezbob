(function(){var t,n,r={}.hasOwnProperty,i=function(n,t){function u(){this.constructor=n}for(var i in t)r.call(t,i)&&(n[i]=t[i]);return u.prototype=t.prototype,n.prototype=new u,n.__super__=t.prototype,n},u=function(n,t){return function(){return n.apply(t,arguments)}};n=typeof exports!="undefined"&&exports!==null?exports:this,n.EzBob=n.EzBob||{},EzBob.Underwriter=EzBob.Underwriter||{},EzBob.Underwriter.LoanInfoView=function(n){function r(){return r.__super__.constructor.apply(this,arguments)}return i(r,n),r.prototype.template="#profile-loan-info-template",r.prototype.initialize=function(n){this.bindTo(this.model,"change reset",this.render,this),this.personalInfo=n.personalInfo,this.bindTo(this.personalInfo,"change",this.UpdateNewCreditLineState,this),this.bindTo(this.personalInfo,"change:CreditResult",this.changeCreditResult,this);return EzBob.App.vent.on("newCreditLine:done",this.showCreditLineDialog,this)},r.prototype.events={"click [name='startingDateChangeButton']":"editStartingDate","click [name='offerValidUntilDateChangeButton']":"editOfferValidUntilDate","click [name='repaymentPeriodChangeButton']":"editRepaymentPeriod","click [name='interestRateChangeButton']":"editInterestRate","click [name='openCreditLineChangeButton']":"editOfferedCreditLine","click [name='editDetails']":"editDetails","click [name='setupFeeEditButton']":"editSetupFee","click [name='newCreditLineBtn']":"runNewCreditLine",'click [name="allowSendingEmail"]':"allowSendingEmail",'click [name="loanType"]':"loanType"},r.prototype.editOfferValidUntilDate=function(){var n;n=new EzBob.Dialogs.DateEdit({model:this.model,propertyName:"OfferValidateUntil",title:"Offer valid until edit",postValueName:"date",url:"Underwriter/ApplicationInfo/ChangeOferValid",data:{id:this.model.get("CustomerId")}}),n.render()},r.prototype.editStartingDate=function(){var n,t;t=this,n=new EzBob.Dialogs.DateEdit({model:this.model,propertyName:"StartingFromDate",title:"Starting date edit",postValueName:"date",url:"Underwriter/ApplicationInfo/ChangeStartingDate",data:{id:this.model.get("CustomerId")}}),n.render();n.on("done",function(){return t.model.fetch()})},r.prototype.editRepaymentPeriod=function(){var n;n=new EzBob.Dialogs.IntegerEdit({model:this.model,propertyName:"RepaymentPerion",title:"Repayment period edit",postValueName:"period",url:"Underwriter/ApplicationInfo/ChangeCashRequestRepaymentPeriod",data:{id:this.model.get("CashRequestId")}}),n.render()},r.prototype.editOfferedCreditLine=function(){var n;n=new EzBob.Dialogs.OfferedCreditLineEdit({model:this.model,propertyName:"OfferedCreditLine",title:"Offer credit line edit",postValueName:"amount",url:"Underwriter/ApplicationInfo/ChangeCashRequestOpenCreditLine",data:{id:this.model.get("CashRequestId")},min:EzBob.Config.XMinLoan,max:EzBob.Config.MaxLoan}),n.render()},r.prototype.editInterestRate=function(){var n;n=new EzBob.Dialogs.PercentsEdit({model:this.model,propertyName:"InterestRate",title:"Interest rate edit",postValueName:"interestRate",url:"Underwriter/ApplicationInfo/ChangeCashRequestInterestRate",data:{id:this.model.get("CashRequestId")}}),n.render()},r.prototype.editDetails=function(){var n;n=new EzBob.Dialogs.TextEdit({model:this.model,propertyName:"Details",title:"Details edit",postValueName:"details",url:"Underwriter/ApplicationInfo/SaveDetails",data:{id:this.model.get("CustomerId")}}),n.render()},r.prototype.editSetupFee=function(){var n;n=new EzBob.Dialogs.CheckBoxEdit({model:this.model,propertyName:"UseSetupFee",title:"Setup Fee",postValueName:"enbaled",checkboxName:"Enable Setup Fee",url:"Underwriter/ApplicationInfo/ChangeSetupFee",data:{id:this.model.get("CashRequestId")}}),n.render()},r.prototype.runNewCreditLine=function(n){return $(n.currentTarget).hasClass("disabled")?!1:(this.RunCustomerCheck(),!1)},r.prototype.RunCustomerCheck=function(){var n=this;return BlockUi("on"),$.post(window.gRootPath+"Underwriter/ApplicationInfo/RunNewCreditLine",{Id:this.model.get("CustomerId")}).done(function(){var i;return i=new t(n.personalInfo,"CreditResult"),i.start()}).fail(function(n){return console.error(n.responseText)}),!1},r.prototype.allowSendingEmail=function(){var n;n=new EzBob.Dialogs.CheckBoxEdit({model:this.model,propertyName:"AllowSendingEmail",title:"Allow sending emails",postValueName:"enbaled",checkboxName:"Allow",url:"Underwriter/ApplicationInfo/AllowSendingEmails",data:{id:this.model.get("CashRequestId")}}),n.render()},r.prototype.loanType=function(){var n,t=this;n=new EzBob.Dialogs.ComboEdit({model:this.model,propertyName:"LoanTypeId",title:"Loan type",comboValues:this.model.get("LoanTypes"),postValueName:"LoanType",url:"Underwriter/ApplicationInfo/LoanType",data:{id:this.model.get("CashRequestId")}}),n.render();n.on("done",function(){return t.model.fetch()})},r.prototype.UpdateNewCreditLineState=function(){var n,t,i;return i=this.personalInfo.get("CreditResult")==="WaitingForDecision",n=this.personalInfo.get("Disabled")!==0,t=i||n,this.$el.find("input[name='newCreditLineBtn']").toggleClass("disabled",t)},r.prototype.serializeData=function(){return{m:this.model.toJSON()}},r.prototype.onRender=function(){return this.UpdateNewCreditLineState()},r.prototype.changeCreditResult=function(){return this.model.fetch(),this.personalInfo.fetch()},r.prototype.showCreditLineDialog=function(){var n,t=this;return n=this.model.fetch(),n.done(function(){var n;return n=new EzBob.Underwriter.CreditLineDialog({model:t.model}),n.render(),EzBob.App.modal.show(n)})},r}(Backbone.Marionette.ItemView),t=function(){function n(n,t){this.model=n,this.property=t,this.start=u(this.start,this)}return n.prototype.start=function(){var n,t=this;return n=this.model.fetch(),n.done(function(){return t.check()})},n.prototype.check=function(){if(this.model.get(this.property).isNullOrEmpty())setTimeout(this.start,1e3);else{BlockUi("off"),EzBob.App.vent.trigger("newCreditLine:done");return}return this},n}(),EzBob.Underwriter.LoanInfoModel=function(n){function t(){return t.__super__.constructor.apply(this,arguments)}return i(t,n),t.prototype.idAttribute="Id",t.prototype.urlRoot=""+window.gRootPath+"Underwriter/ApplicationInfo/Index",t.prototype.initialize=function(){this.on("change:OfferValidateUntil",this.offerChanged,this);return this.on("change:LoanTypeId",this.loanTypeChanged,this)},t.prototype.offerChanged=function(){var n,t;return t=moment(this.get("OfferValidateUntil"),"DD/MM/YYYY"),n=moment(),this.set({OfferExpired:t<n})},t.prototype.loanTypeChanged=function(){var n,t,i;return i=this.get("LoanTypes"),n=parseInt(this.get("LoanTypeId"),10),t=_.find(i,function(t){return t.value===n}),this.set("LoanType",t.text)},t}(Backbone.Model)}).call(this)