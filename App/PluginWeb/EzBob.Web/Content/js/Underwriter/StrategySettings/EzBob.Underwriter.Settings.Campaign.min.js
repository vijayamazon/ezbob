(function(){var t,i={}.hasOwnProperty,n=function(n,t){function u(){this.constructor=n}for(var r in t)i.call(t,r)&&(n[r]=t[r]);return u.prototype=t.prototype,n.prototype=new u,n.__super__=t.prototype,n};t=typeof exports!="undefined"&&exports!==null?exports:this;t.EzBob=t.EzBob||{};EzBob.Underwriter=EzBob.Underwriter||{};EzBob.Underwriter.Settings=EzBob.Underwriter.Settings||{};EzBob.Underwriter.Settings.CampaignModel=function(t){function i(){return i.__super__.constructor.apply(this,arguments)}return n(i,t),i.prototype.url=window.gRootPath+"Underwriter/StrategySettings/SettingsCampaign",i}(Backbone.Model);EzBob.Underwriter.Settings.CampaignView=function(t){function i(){return i.__super__.constructor.apply(this,arguments)}return n(i,t),i.prototype.template="#campaign-settings-template",i.prototype.initialize=function(){this.model.on("reset",this.render,this);return this.update(),this},i.prototype.events={"click .addCampaign":"addCampaign","click .editCampaign":"editCampaign","click .campaignCustomers":"campaignCustomers"},i.prototype.campaignCustomers=function(n){var t;return t=parseInt($(n.currentTarget).attr("data-campaign-id")),this.campaignCustomersView=new EzBob.Underwriter.Settings.CampaignCustomersView({campaign:this.getCampaign(t)}),EzBob.App.jqmodal.show(this.campaignCustomersView)},i.prototype.editCampaign=function(n){var t;return t=parseInt($(n.currentTarget).attr("data-campaign-id")),this.addCampaign(n,this.getCampaign(t))},i.prototype.getCampaign=function(n){var t,i=this.model.get("campaigns");for(t in i)if(i[t].Id===n)return i[t]},i.prototype.addCampaign=function(n,t){BlockUi("On");this.addCampaignView=new EzBob.Underwriter.Settings.AddCampaignView({model:this.model,campaign:t});this.addCampaignView.on("campaign-added",this.update,this);return EzBob.App.jqmodal.show(this.addCampaignView),BlockUi("Off")},i.prototype.serializeData=function(){return{campaigns:this.model.get("campaigns")}},i.prototype.update=function(){var n=this;return this.addCampaignView&&EzBob.App.jqmodal.hideModal(this.addCampaignView),this.model.fetch().done(function(){return n.render()})},i.prototype.onRender=function(){if(!$("body").hasClass("role-manager"))return this.$el.find("select").addClass("disabled").attr({readonly:"readonly",disabled:"disabled"}),this.$el.find("button").hide()},i.prototype.show=function(){return this.$el.show()},i.prototype.hide=function(){return this.$el.hide()},i}(Backbone.Marionette.ItemView);EzBob.Underwriter.Settings.AddCampaignView=function(t){function i(){return i.__super__.constructor.apply(this,arguments)}return n(i,t),i.prototype.template="#add-campaign-template",i.prototype.initialize=function(n){this.model.on("reset",this.render,this);return this.isUpdate=!1,n.campaign&&(this.isUpdate=!0,this.campaign=n.campaign),this.update(),this},i.prototype.events={"click .addCampaignBtn":"addCampaign"},i.prototype.ui={form:"form",name:"#campaign-name",description:"#campaign-description",type:"#campaign-type option",startdate:"#campaign-start-date",enddate:"#campaign-end-date",clients:"#campaign-customers",addCampaignBtn:".addCampaignBtn"},i.prototype.addCampaign=function(){var t,i,r,n,u=this;return BlockUi("on"),t=this.ui.form.serialize(),this.isUpdate&&(t+="&campaignId="+this.campaign.Id),r=this,i=function(){return r.trigger("campaign-added")},n=$.post(""+window.gRootPath+"Underwriter/StrategySettings/AddCampaign/?"+t),n.done(function(n){if(n.errorText=n.errorText?n.errorText:n.error?n.error:"",!n.success){EzBob.ShowMessage("Failed to add/update the campaign. "+n.errorText,"Failure",null,"OK");return}return EzBob.ShowMessage("Successfully Added/Updated. "+n.errorText,"The campaign added/updated successfully.",i,"OK")}),n.fail(function(){return EzBob.ShowMessage("Failed to add/update the campaign. ","Failure",null,"OK")}),n.always(function(){return BlockUi("off")}),!1},i.prototype.update=function(){var n,t=this;return n=this.model.fetch(),n.done(function(){return t.render()})},i.prototype.onRender=function(){var n;return this.$el.find("input.date").datepicker({format:"dd/mm/yyyy"}),n=this,this.isUpdate?(this.ui.name.val(this.campaign.Name),this.ui.description.val(this.campaign.Description),this.$el.find("#campaign-type option").filter(function(){return this.text===n.campaign.Type}).prop("selected",!0),this.ui.startdate.val(EzBob.formatDate2(this.campaign.StartDate)),this.ui.enddate.val(EzBob.formatDate2(this.campaign.EndDate)),this.ui.clients.val(_.pluck(this.campaign.Customers,"Id").join().replace(/,/g," ")),this.ui.addCampaignBtn.html("Update Campaign")):void 0},i.prototype.jqoptions=function(){return{modal:!0,resizable:!1,title:this.isUpdate?"Update campaign":"Add Campaign",position:"center",draggable:!1,width:"40%",height:670,dialogClass:"addCampaign"}},i.prototype.serializeData=function(){return{campaignTypes:this.model.get("campaignTypes")}},i}(Backbone.Marionette.ItemView);EzBob.Underwriter.Settings.CampaignCustomersView=function(t){function i(){return i.__super__.constructor.apply(this,arguments)}return n(i,t),i.prototype.template="#campaign-customers-template",i.prototype.initialize=function(n){return n.campaign&&(this.campaign=n.campaign),this},i.prototype.jqoptions=function(){return{modal:!0,resizable:!1,title:"Campaign "+this.campaign.Name+" clients",position:"center",draggable:!0,width:"40%",height:670,dialogClass:"CampaignClients"}},i.prototype.serializeData=function(){return{campaign:this.campaign}},i.prototype.show=function(){return this.$el.show()},i.prototype.hide=function(){return this.$el.hide()},i}(Backbone.Marionette.ItemView)}).call(this)