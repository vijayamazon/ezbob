(function(){var n,i={}.hasOwnProperty,t=function(n,t){function u(){this.constructor=n}for(var r in t)i.call(t,r)&&(n[r]=t[r]);return u.prototype=t.prototype,n.prototype=new u,n.__super__=t.prototype,n};n=typeof exports!="undefined"&&exports!==null?exports:this;n.EzBob=n.EzBob||{};EzBob.Underwriter=EzBob.Underwriter||{};EzBob.Underwriter.ReportModel=function(n){function i(){return i.__super__.constructor.apply(this,arguments)}return t(i,n),i.prototype.url=""+gRootPath+"Underwriter/Report/GetAll",i}(Backbone.Model);EzBob.Underwriter.ReportView=function(n){function i(){return i.__super__.constructor.apply(this,arguments)}return t(i,n),i.prototype.template="#report-template",i.prototype.initialize=function(){this.model=new EzBob.Underwriter.ReportModel;this.model.on("change reset",this.render,this);return this.model.fetch()},i.prototype.ui={reportsDdl:"#reportsDdl",datesDdl:"#datesDdl",reportArea:"#reportDiv",dateRange:"#form-date-range",customerDiv:"#reportCustomerDiv",nonCashDiv:"#reportNonCashDiv",customer:"#reportCustomer",nonCash:"#reportNonCash"},i.prototype.serializeData=function(){return{reports:this.model.toJSON()}},i.prototype.events={"change #reportsDdl":"reportChanged","change #datesDdl":"dateChanged","change #reportNonCash":"nonCashChanged","click #getReportBtn":"getReportClicked","click #downloadReportBtn":"downloadReportClicked"},i.prototype.onRender=function(){return this.ui.reportsDdl.chosen(),this.ui.datesDdl.chosen(),EzBob.handleUserLayoutSetting()},i.prototype.reportChanged=function(){var n,t,i=this;return t=parseInt(this.ui.reportsDdl.val()),n=_.find(this.model.toJSON().reports,function(n){return n.Id===t}),n!=null&&n.IsCustomer?this.ui.customerDiv.show():this.ui.customerDiv.hide(),n!=null&&n.ShowNonCash?(this.ui.nonCashDiv.show(),this.nonCashChanged()):(this.ui.nonCashDiv.hide(),this.ui.nonCash.val(""))},i.prototype.dateChanged=function(){return this.ui.datesDdl.val()==="Custom"?this.initDateRange():this.destroyDateRange()},i.prototype.nonCashChanged=function(){return this.ui.nonCash.val(this.ui.nonCash.is(":checked")?"true":"false")},i.prototype.downloadReportClicked=function(){var n,t;return this.ui.reportsDdl.val()==="0"||this.ui.datesDdl.val()==="0"?(alertify.error("Select report and/or date range"),!1):this.ui.datesDdl.val()==="Custom"?(n=EzBob.formatDateTimeCS(this.ui.dateRange.data("daterangepicker").startDate),t=EzBob.formatDateTimeCS(this.ui.dateRange.data("daterangepicker").endDate),window.location=""+window.gRootPath+"Underwriter/Report/DownloadReportDates/?reportId="+this.ui.reportsDdl.val()+"&from="+n+"&to="+t+"&customer="+this.ui.customer.val()+"&nonCash="+this.ui.nonCash.val()):window.location=""+window.gRootPath+"Underwriter/Report/DownloadReport/?reportId="+this.ui.reportsDdl.val()+"&reportDate="+this.ui.datesDdl.val()+"&customer="+this.ui.customer.val()+"&nonCash="+this.ui.nonCash.val()},i.prototype.getReportClicked=function(){var i,r,n,t=this;return this.ui.reportsDdl.val()==="0"||this.ui.datesDdl.val()==="0"?(alertify.error("Select report and/or date range"),!1):(this.ui.datesDdl.val()==="Custom"?(i=EzBob.formatDateTimeCS(this.ui.dateRange.data("daterangepicker").startDate),r=EzBob.formatDateTimeCS(this.ui.dateRange.data("daterangepicker").endDate),n=$.post(""+window.gRootPath+"Underwriter/Report/GetReportDates",{reportId:this.ui.reportsDdl.val(),from:i,to:r,customer:this.ui.customer.val(),nonCash:this.ui.nonCash.val()})):n=$.post(""+window.gRootPath+"Underwriter/Report/GetReport",{reportId:this.ui.reportsDdl.val(),reportDate:this.ui.datesDdl.val(),customer:this.ui.customer.val(),nonCash:this.ui.nonCash.val()}),n.done(function(n){if(n.report!=null)return t.ui.reportArea.html(n.report),t.ui.reportArea.children().addClass("row"),t.formatTable(n.columns)}))},i.prototype.formatTable=function(n){var t;return $("#tableReportData").addClass("table table-bordered table-striped blue-header centered"),t={aLengthMenu:[[10,20,50,100,200,-1],[10,20,50,100,200,"All"]],iDisplayLength:20,aaSorting:[],aoColumns:n},$("#tableReportData").dataTable(t)},i.prototype.initDateRange=function(){return this.ui.dateRange.show(),this.ui.dateRange.daterangepicker({format:"MM/dd/yyyy",startDate:Date.today().add({days:-29}),endDate:Date.today(),minDate:"01/01/2012",locale:{applyLabel:"Select",fromLabel:"From",toLabel:"To&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"},showWeekNumbers:!0,buttonClasses:["btn-success","btn-fullwidth"]},function(n,t){$("#form-date-range span").html(n.toString("MMMM d, yyyy")+" - "+t.toString("MMMM d, yyyy"))}),this.$el.find("#form-date-range span").html(Date.today().add({days:-29}).toString("MMMM d, yyyy")+" - "+Date.today().toString("MMMM d, yyyy"))},i.prototype.destroyDateRange=function(){this.ui.dateRange.hide()},i.prototype.show=function(){return this.$el.show()},i.prototype.hide=function(){return this.$el.hide()},i}(Backbone.Marionette.ItemView)}).call(this)