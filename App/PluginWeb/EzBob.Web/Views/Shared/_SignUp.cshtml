@using EzBob.Web.Infrastructure
@using Scorto.NHibernate.Model
@using StructureMap
@using EZBob.DatabaseLib.Model.Database
@model dynamic
@{
    var securityQuestions = @ViewData["Questions"] as List<SecurityQuestion>;
    var customerReason = @ViewData["Reasons"] as List<CustomerReason>;
    var customerSourceOfRepayment = @ViewData["Sources"] as List<CustomerSourceOfRepayment>;
    var config = ObjectFactory.GetInstance<IEzBobConfiguration>();
    string captchamode = config.CaptchaMode;
    bool ebayPixelEnabled = config.EbayPixelEnabled;
    bool instructionsEnabled = config.WizardInstructionsEnabled;
    bool isOffline = @Request.Cookies["isoffline"] != null && @Request.Cookies["isoffline"].Value == "yes";
    bool twilioEnabled = config.TwilioEnabled;
}

@using (Html.BeginForm("SignUp", "Account", new {Area = ""}, FormMethod.Post, new {@class = "signup clearfix"}))
{
    <h2 class="form_start">Create account</h2>
    
    if (ebayPixelEnabled)
    {
        <img src="https://ad-emea.doubleclick.net/activity;dc_pixel_url=rmboom;rm=ezbobregister;ord='<%- ordsu %>'?" width="1" height="1" border="0" alt="" />
    }
    
	<div class="form_field_container">
		<label class="attardi-input">
			<span>Email address</span>
		    <input type="email" name="Email" id="Email" tabindex="1" class="form_field" ui-event-control-id="signup:email" />
            <img id="EmailImage" class="field_status required"/>
		</label>
	</div>

	<div id="strength-password-view" class="form_field_container">
		<label class ="attardi-input">
			<span>Password</span>
		    <input type="password" tabindex="2" class="form_field" name="signupPass1" id="signupPass1" ui-event-control-id="signup:password1" />
            <img id="Password1Image" class="field_status required"/>
		</label>
		<p id="message" class="help-block"></p>
	</div>

	<div class="form_field_container">
		<label class ="attardi-input">
			<span>Confirm password</span>
		    <input type="password" tabindex="3" class="form_field" name="signupPass2" id="signupPass2" ui-event-control-id="signup:password2" />
            <img id="Password2Image" class="field_status required"/>
		</label>
	</div>
    
    <div class="form_field_container">
		<label class="attardi-input">
			<span>Secret question</span>
			<select name="securityQuestion" id="securityQuestion" tabindex="4" class="form_field" ui-event-control-id="signup:security_question">
			    <option value=""></option>
			    @if (securityQuestions != null) {
			        foreach (var item in securityQuestions) {
			            <option value="@item.Id">@item.Name</option>
			        } // foreach
			    } // if
			</select>
            <img id="SecurityQuestionImage" class="field_status required" />
		</label>
	</div>

    <div class="form_field_container">
        <label class="attardi-input">
            <span>Secret answer</span>
            <input type="text" name="SecurityAnswer" id="SecurityAnswer" tabindex="5" class="form_field" ui-event-control-id="signup:security-answer" />
            <img id="SecretAnswerImage" class="field_status required"/>
        </label>
    </div>
    
    if (isOffline)
    {
        <h2 class="form_start">Requested loan</h2>
    
        <div class="form_field_container">
            <label class="attardi-input">
                <span>Requested loan amount</span>
                <input type="text" name="amount" id="amount" tabindex="6" class="form_field" ui-event-control-id="signup:requested-amount" />
                <img id="amountImage" class="field_status"/>
            </label>
        </div>

        <div class="form_field_container hide">
            <label class="attardi-input">
                <span>Reason</span>
                <select name="customerReason" id="customerReason" tabindex="7" class="form_field" ui-event-control-id="signup:reason-list">
                    <option value=""></option>
                    @if (customerReason != null)
                    {
                        foreach (var item in customerReason)
                        {
                            <option value="@item.Id">@item.Reason</option>
                        } // foreach
                    } // if
                </select>
                <img id="customerReasonImage" class="field_status required" />
            </label>
        </div>

        <div class="form_field_container hide" id="otherReasonDiv">
            <label class="attardi-input">
                <span>Other reason</span>
                <input type="text" name="otherCustomerReason" id="otherCustomerReason" tabindex="8" class="form_field" ui-event-control-id="signup:other-reason" />
                <img id="otherReasonImage" class="field_status required"/>
            </label>
        </div>

        <div class="form_field_container hide">
            <label class="attardi-input">
                <span>Source of repayment</span>
                <select name="customerSourceOfRepayment" id="customerSourceOfRepayment" tabindex="9" class="form_field" ui-event-control-id="signup:repayment-source-list">
                    <option value=""></option>
                    @if (customerSourceOfRepayment != null)
                    {
                        foreach (var item in customerSourceOfRepayment)
                        {
                            <option value="@item.Id">@item.SourceOfRepayment</option>
                        } // foreach
                    } // if
                </select>
                <img id="customerSourceOfRepaymentImage" class="field_status required" />
            </label>
        </div>

        <div class="form_field_container hide" id="otherSourceDiv">
            <label class="attardi-input">
                <span>Other source of repayment</span>
                <input type="text" name="otherCustomerSourceOfRepayment" id="otherCustomerSourceOfRepayment" tabindex="10" class="form_field" ui-event-control-id="signup:other-repayment-source" />
                <img id="otherCustomerSourceOfRepaymentImage" class="field_status required"/>
            </label>
        </div>
    }
    else
    {
        <div class="form_field_container">
            <label class ="attardi-input">
                <span>Promotional code (optional)</span>
                <input type="text" class="form_field" name="promoCode" id="promoCode" ui-event-control-id="signup:promo-code"/>
                <img id="promoCodeImage" class="field_status"/>
            </label>
        </div>
    }
    
    if (twilioEnabled)
    {
        <div id="twilioDiv">
            <div class="form_field_container">
                <label class ="attardi-input">
                    <span>Mobile phone</span>
                    <input type="text" class="phonenumber form_field" name="mobilePhone" id="mobilePhone" tabindex="11" ui-event-control-id="signup:mobile-phone"/>
                    <img id="mobilePhoneImage" class="field_status required"/>
                </label>
            </div>
    
            <input class="btn green generateMobileCode" type="button" value="Get authentication code" ui-event-control-id="signup:get-mobile-code" />
    
            <div class="form_field_container">
                <label class ="attardi-input">
                    <span>Mobile phone authentication code</span>
                    <input type="text" class="phonenumbercode form_field" name="mobileCode" id="mobileCode" tabindex="12" ui-event-control-id="signup:mobile-code"/>
                    <img id="mobileCodeImage" class="field_status required"/>
                </label>
            </div>
        </div>
    }
    
    <div id="captchaDiv" class="hide">
        <div class="form_field_container">
            @EzForm.Captcha(captchamode)
        </div>
    </div>
    
    <div class="form_buttons_container">
        <div class="attardi-button">
            <input type="submit" id="signupSubmitButton" value="Continue" class="rc-button green continue disabled" tabindex="13" ui-event-control-id="signup:submit">
        </div>
    </div>

    if (isOffline && instructionsEnabled) {
		<div class="hide">
			<div id="offline_help" class="help_window">
				<h2>Welcome to the ezbob application process</h2>
				<p>Please find below what you need to complete your application successfully.</p>
				@*<p>Good Luck, and please contact us with any issue, question or comment.</p>*@

				<div class="help_image help_offline"></div>

				<p>Complete it in five minutes.</p>

				<br>

				<div class="alignright" style="padding: 0 10px 0 0;">
					<a href="javascript:$.colorbox.close()" target="_blank" class="button orange pull-right" ui-event-control-id="signup:offline-popup-continue">Continue</a>
				</div>

				<div class="clear"></div>
				<hr>
				<div class="help_security"></div>
			</div>
		</div>
	}
}