@using System.Globalization
@using ConfigManager
@using EZBob.DatabaseLib
@using EzBob.CommonLib
@using EzBob.Web.Infrastructure
@using EzBob.Web.Infrastructure.csrf
@using Integration.ChannelGrabberConfig
@using Newtonsoft.Json
@using StructureMap
@{
    var controller = (string)ViewContext.RouteData.Values["controller"];
    bool getSatisfactionEnabled = CurrentValues.Instance.GetSatisfactionEnabled;
    var showGetSatisfaction = controller == "Wizard" && getSatisfactionEnabled;
    var authCookie = Request.IsAuthenticated ? "auth" : "";

    var oDBHelper = ObjectFactory.GetInstance<IDatabaseDataHelper>() as DatabaseDataHelper;
}
<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="Content-type" content="text/html;charset=UTF-8">
    @{ Html.RenderPartial("_FrameKiller"); }

    @RenderSection("head", false)

    @if (controller == "Wizard")
    {
        <meta name="description" content="Online sellers sign up for a free account to apply for an ecommerce business loan. Funds can be in your account within 30 minutes." />
    }

    <title>@ViewBag.Title</title>

    <meta name="webutation-site-verification" content="webutation66c78d618b360eb461a120920e8ab3a3" />

    <meta name="msvalidate.01" content="AFD649895CD47944F50BFA0BE7BAB5D8" />

    @{ Html.RenderPartial("_FavIcon"); }

    <link href='https://fonts.googleapis.com/css?family=Sanchez' rel='stylesheet' type='text/css'>

    @if (IsSectionDefined("css"))
    {
        @RenderSection("css", false)
    }
    else
    {
        @BundleHelper.CustomerCss()
    }

    @BundleHelper.RenderPrintCss()
    <!--[if lt IE 9]>
            <script src="https://html5shiv.googlecode.com/svn/trunk/html5.js"> </script>
        <![endif]-->
    @{ Html.RenderPartial("_GoogleAnalytics"); }
    @{Html.RenderPartial("security_template");}
</head>

<body auth="@authCookie" data-user-name="">
    @{Html.RenderPartial("_GoogleTagManager");}
    @RenderSection("afterHead", false)

    @{
        var isUnderwriter = (Url.Action(null) ?? "").Contains("AdminLogOn");
        if (!isUnderwriter && !Request.Browser.IsMobileDevice)
        {
            Html.RenderPartial("_LivePerson");
            if (controller == "Wizard")
            {
                Html.RenderPartial("_NanoRep");
            }
        }
    }

    @Html.AntiForgeryTokenNoUserCheck()

    <div id="wrapper">
		<div id="header">
			<div class="header-inner">
				<a href="http://www.ezbob.com">
					<img src="@Url.Content("~/Content/img/ezbob-logo-2014.png")" class="newlogo"></a>

				<div class="header-phone">0800-011-4787</div>

				<div class="eu-menu">
					<img src="@Url.Content("~/Content/img/eu-menu.png")"><br>
					Authorised by the European Union
				</div>

				<ul id="user-menu">
					<li id="logoff-li" class="login" style="display: none;">
						<a href="@Url.Action("LogOff", "Account", new { Area = "" })">LOG OFF</a>
					</li>
					<li class="login login_btn" style="display: none;"><a href="@Url.Action("LogOn", "Account", new { Area = "" })">LOGIN</a></li>
					<li class="sign-up signup_btn" style="display: none"><a href="@Url.Action("Index", "Wizard", new { Area = "Customer" }, "https")#SignUp">SIGN UP</a></li>
				</ul>
			</div>
		</div>

        <div class="inner main-page">
            <section id="full_width">
                @RenderBody()
            </section>
        </div>

        <div id="modalRegion" class="modal hide fade">
        </div>
        <div class="push"></div>
    </div>

    <!--wraper-->
    <footer>
        @{ Html.RenderPartial("_Copyright"); }
    </footer>
    <script type="text/javascript">
        window.gRootPath = '@Url.Content("~/")';
    </script>
    <script id="login-template" type="text/template">
        @{ Html.RenderPartial("_LoginSimple"); }
    </script>

    @if (IsSectionDefined("customJs"))
    {
        @RenderSection("customJs")
    }
    else
    {
        @BundleHelper.RenderJs()
        @BundleHelper.RenderProfileJs()
    }
    @RenderSection("Js", false)
    
	<script type="text/javascript">
		function ShowHideSignLogOnOff() {
			var sEmail = $('body').attr('data-user-name');
			if (sEmail) {
				$('#logoff-li').show().tooltip({ placement: 'bottom', title: sEmail }).tooltip("enable").tooltip('fixTitle');
				$('#user-menu .login_btn, .signup_btn').hide();
			}
			else {
				$('#logoff-li').hide();

				if ($('.login-form-user-name').length) {
					$('.login_btn').hide();
					$('.signup_btn').show();
				}
				else {
					$('.login_btn').show();
					$('.signup_btn').hide();
				} // if
			} // if
		} // ShowHideSignLogOnOff

		$(document).ready(function() {
			$('body').attr('data-user-name', '@(User.Identity.IsAuthenticated ? User.Identity.Name : "")');
			ShowHideSignLogOnOff();
		});
	</script>

    @{ Html.RenderPartial("_ClickTale"); }
    @{ Html.RenderPartial("_AddRoll"); }
    @{
        if (showGetSatisfaction)
        {
            Html.RenderPartial("_GetSatisfaction");
        }
    }

    <div style="display: none;" class="hide" id="cg-account-model-template">@JsonConvert.SerializeObject(new Integration.ChannelGrabberFrontend.AccountModel())</div>
    <div style="display: none;" class="hide" id="cg-account-list">@JsonConvert.SerializeObject(Configuration.Instance.Vendors)</div>
    <div style="display: none;" class="hide" id="current-server-time-zone">@DateTimeOffset.Now.ToString("zzz", CultureInfo.InvariantCulture)</div>
    <div style="display: none;" class="hide" id="yodlee-banks">@oDBHelper.YodleeBanks</div>
    <div style="display: none;" class="hide" id="customer-name"></div>
</body>
</html>
