@using Newtonsoft.Json

@model dynamic
@{
    ViewBag.Title = "Updating Yodlee";
}

<h2>Trying to Update Yodlee</h2>

@section Js
{
    <script type="text/javascript">
        $(window).load(function () {
            $(function () {
                console.log("callback");
                if (querystring('oauth_error_code').length > 0) {
                    console.log(querystring('oauth_error_code'));
                    //window.opener.YodleeAccountUpdatingError("Error occurred while trying to update yodlee");
                    alert('Error occurred while trying to update yodlee');
                    self.close();

                } else {
                    console.log("4", @Html.Raw(JsonConvert.SerializeObject(Model)));
                    alert('Yodlee updated', @Html.Raw(JsonConvert.SerializeObject(Model)));
                    //window.opener.YodleeAccountUpdated(@Html.Raw(JsonConvert.SerializeObject(Model)));
                    self.close();
                }

                function querystring(key) {
                    var re = new RegExp('(?:\\?|&)' + key + '=(.*?)(?=&|$)', 'gi');
                    var r = [], m;
                    while ((m = re.exec(document.location.search)) != null) {
                        r.push(m[1]);
                    }
                    return r;
                }
        });
    });
    </script>
}
