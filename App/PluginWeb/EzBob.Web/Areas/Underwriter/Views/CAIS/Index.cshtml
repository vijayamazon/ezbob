@model dynamic

@{
    ViewBag.Title = "CAIS";
    Layout = "../Shared/_Layout.cshtml";
}

<div class="content file-list"></div>

<div id="loan_editor_schedule_template"></div>

<script type="text/template" id="cais-template">
    @CaisReports()
</script>

@section Js{
    <script type="text/javascript">
        $("#liReports").removeClass("active");
        $("#liApplications").removeClass("active");
        $("#liCAIS").addClass("active");
        $("#liStrategySettings").removeClass("active");
        var view = new EzBob.Underwriter.CAIS.CaisManageView({ el: ".content" });
    </script>
}

@helper CaisReports()
{
    <fieldset>
        <legend>CAIS reports</legend>
        <div class="simple-well cais-manage-controls">
            <button class="generate btn btn-primary"><i class="icon-cog"></i>Generate current reports</button>
            <button class="send btn btn-success"><i class="icon-upload"></i>Send selected reports (<span class="reports-count"></span>)</button>
        </div>
        
        <table class="table-bordered blue-header table cais-table">
            <thead>
                @EzForm.RawHeaderCell("Reports history", "","","","","", "","")
            </thead>
            <tbody>
                @EzForm.RawCellBold("Generation Date", "Name", "Type", "Total account", "Good accounts","Late accounts", "Defaults", "Upload status" )
                <% var currentCollor = "first";%>
                <% _.each(model, function(val, i){ %>
                <% 
                var timeDiffWithPreviousInHour = i > 0 ? ((new Date(model[i-1].Date)) - (new Date(val.Date)) )/1000/60 : 0;
                if( !( timeDiffWithPreviousInHour <= 1 && timeDiffWithPreviousInHour >= 0) ){
                currentCollor = currentCollor == "first" ? "seccond" : "first";
                }
                var checkedClass = _.filter(checkedModel, function(value){  return value.path == val.FilePath }).length === 0 ? '':'checked';
                %>
                <tr class="<%- currentCollor %> <%- checkedClass %>" data-file-path ="<%-val.FilePath%>">
                    <td><%-val.Date%></td>
                    <td data-path ="<%-val.FilePath%>" class="blue-link"><div  data-toggle="tooltip" title="<%-val.FilePath%>"><%-val.FileName%></div></td>
                    <td><%-val.Type%></td>
                    <td><%-val.OfItems%></td>
                    <td><%-val.GoodUsers%></td>
                    <td><%-val.OfItems - val.GoodUsers%></td>
                    <td><%-val.Defaults%></td>
                    <td><%-val.CaisUploadStatus%></td>
                </tr>
                <%})%>
            </tbody>
        </table>
    </fieldset>
}