@model dynamic
<script id="dashboard-template" type="text/template">
    <div>
        <%if(loan){ %>
        <div class="col-md-7">
            <div class="box">
                <div class="box-title">
                    <h3><i class="fa fa-bar-chart-o"></i>Offer</h3>
                    <div class="box-tool">
                        <a data-action="collapse" href="#"><i class="fa fa-chevron-up"></i></a>
                        <a data-action="close" href="#"><i class="fa fa-times"></i></a>
                    </div>
                </div>
                <div class="box-content">
                    <ul class="summary-offer">
                        <li>
                            <p>
                                <span>Amount</span>
                                <span class="light-green"><%-EzBob.formatPoundsNoDecimals(loan.OfferedCreditLine)%></span>
                            </p>
                        </li>
                        <li>
                            <p>
                                <span>Monthly interest</span>
                                <span class="light-green"><%-EzBob.formatPercents(loan.InterestRate)%></span>
                            </p>
                        </li>
                        <li>
                            <p>
                                <span>Term</span>
                                <span class="light-green"><%-loan.RepaymentPerion%> months</span>
                            </p>
                        </li>
                        <li>
                            <p>
                                <span>Setup fee</span>
                                <span class="light-green"><%-EzBob.formatPoundsNoDecimals(loan.SetupFee)%></span>
                            </p>
                        </li>
                    </ul>

                    <div class="form-group hide">
                        <button class="btn btn-primary" id="offer-edit">edit</button>
                        <button class="btn btn-primary" id="offer-calculate">calculate</button>
                    </div>

                </div>
            </div>
        </div>
        <%}%>
        <%if(m.Alerts && m.Alerts.length > 0){%>
        <div class="col-md-5">
            <div class="box">
                <div class="box-title">
                    <h3><i class="fa fa-bar-chart-o"></i>Alerts</h3>
                    <div class="box-tool">
                        <a data-action="collapse" href="#"><i class="fa fa-chevron-up"></i></a>
                        <a data-action="close" href="#"><i class="fa fa-times"></i></a>
                    </div>
                </div>
                <div class="box-content">
                    <%_.each(m.Alerts, function(item) {%>
                    <div class="alert alert-<%-item.AlertType%> hidden-xs">
                        <button class="close" data-dismiss="alert">&times;</button>
                        <h4><%-item.Alert%></h4>
                    </div>
                    <%});%>
                </div>
            </div>
        </div>
        <%}%>
    </div>

    <div>
        <%if(experian) {
            experian.Summary = experian.Summary || {};
            experian.Summary.ConsumerAccountsOverview = experian.Summary.ConsumerAccountsOverview || {};
            experian.ConsumerSummaryCharacteristics = experian.ConsumerSummaryCharacteristics || {};
            experian.ConsumerAccountsOverview = experian.ConsumerAccountsOverview || {};
            var experianCompany = experian.LimitedInfo || experian.NonLimitedInfo || {};
        %>
        <div class="col-md-7 col-sm-12">
            <div class="box">
                <div class="box-title">
                    <h3><i class="fa fa-bar-chart-o"></i>Customer & Directors</h3>
                    <div class="box-tool">
                        <a data-action="collapse" href="#"><i class="fa fa-chevron-up"></i></a>
                        <a data-action="close" href="#"><i class="fa fa-times"></i></a>
                    </div>
                </div>
                <div class="box-content">
                    <div class="row">
                        <div class="col-md-2 col-sm-4">
                            <%var tileColor='';
                              if(!EzBob.isDarkColor(experian.ScoreColor)){
                                tileColor = 'tile-light';
                              }
                            %>
                            <div class="tile <%-tileColor%>" style="background-color: <%-experian.ScoreColor%>">
                                <div class="caption text-center">
                                    Score
                                </div>
                                <p class="title text-center"><%-experian.Score%></p>
                            </div>
                        </div>
                        <div class="col-md-2 col-sm-4">
                            <div class="tile tile-orange">
                                <div class="caption text-center">
                                    Indebtedness
                                </div>
                                <p class="title text-center"><%-experian.CII%></p>
                            </div>
                        </div>
                        <div class="col-md-2 col-sm-4">
                            <div class="tile tile-green">
                                <div class="caption text-center">
                                    Accounts
                                </div>
                                <p class="title text-center"><%-experian.ConsumerAccountsOverview.OpenAccounts_Total%></p>
                            </div>
                        </div>
                        <div class="col-md-2 col-sm-4">
                            <div class="tile tile-green">
                                <div class="caption text-center">
                                    CCJ/Recent CCJ
                                </div>
                                <p class="title text-center"><%-experian.Summary.CCJs%>/<%-experian.Summary.MostrecentCCJ%></p>
                            </div>
                        </div>
                        <div class="col-md-2 col-sm-4">
                            <div class="tile tile-green">
                                <div class="caption text-center">
                                    Defaults
                                </div>
                                <p class="title text-center"><%-experian.ConsumerSummaryCharacteristics.NumberOfDefaults%></p>
                            </div>
                        </div>
                        <div class="col-md-2 col-sm-4">
                            <div class="tile tile-green">
                                <div class="caption text-center">
                                    Balance
                                </div>
                                <% var balance = EzBob.formatPoundsAsThousandsNoDecimals(experian.ConsumerAccountsOverview.Balance_Total);
                                   var textSize = '';
                                if(balance.length > 5){ textSize = 'text-small';} %>
                                <p class="title text-center <%- textSize%>"><%-EzBob.formatPoundsAsThousandsNoDecimals(experian.ConsumerAccountsOverview.Balance_Total)%></p>
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-2 col-sm-4">
                            <div class="tile tile-transparant">
                                <span class="inline-sparkline consumerScoreGraph"></span>
                            </div>
                        </div>
                        <%if(experian.directorsModels && experian.directorsModels.length > 0){
                            _.each(experian.directorsModels, function(item, i){%>
                        <div class="col-md-2 col-sm-4">
                            <%var tileColor='';
                              if(!EzBob.isDarkColor(item.ScoreColor)){
                                tileColor = 'tile-light';
                              }
                            %>
                            <div class="tile <%-tileColor%>" style="background-color: <%-item.ScoreColor%>">
                                <div class="caption text-center">
                                    Director <%-(i+1)%>
                                </div>
                                <p class="title text-center"><%-item.Score%></p>
                            </div>
                        </div>
                        <%});}%>
                        
                    </div>
                </div>
            </div>
        </div>
        <%}%>
        <%if(mps && mps.length > 0) { %>
        <div class="col-md-5 col-sm-12">
            <div class="box">
                <div class="box-title">
                    <h3><i class="fa fa-bar-chart-o"></i>Data Sources</h3>
                    <div class="box-tool">
                        <a data-action="collapse" href="#"><i class="fa fa-chevron-up"></i></a>
                        <a data-action="close" href="#"><i class="fa fa-times"></i></a>
                    </div>
                </div>
                <div class="box-content">
                    <table class="table">
                        <thead>
                            <tr>
                                <th></th>
                                <th>Month sales</th>
                                <th>Annual sales</th>
                                <th>Annual payments</th>
                                <th>Seniority</th>
                                <th>Updated</th>
                            </tr>
                        </thead>
                        <tbody>
                            <%_.each(mps, function(mp){ mp.PaymentAccountBasic = mp.PaymentAccountBasic || {}; %>
                                <tr>
                                    <td style="width:70px"><div class="source_labels_on <%-mp.Name.replace(' ', '').toLowerCase()%>"></div></td>
                                    <td><%- EzBob.formatPoundsNoDecimals(mp.monthSales) %></td>
                                    <td><%- EzBob.formatPoundsNoDecimals(mp.anualSales) %></td>
                                    <td><%- EzBob.formatPoundsNoDecimals(mp.PaymentAccountBasic.TotalNetOutPayments) %></td>
                                    <td><%-mp.age%></td>
                                    <td><%- mp.UpdatingStatus %> <%- mp.LastChecked%></td>
                                </tr>
                            <%});%>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
        <%}%>
    </div>

    <div>
        <div class="col-md-7 col-sm-12">
            <div class="box">
                <div class="box-title">
                    <h3><i class="fa fa-bar-chart-o"></i>Company</h3>
                    <div class="box-tool">
                        <a data-action="collapse" href="#"><i class="fa fa-chevron-up"></i></a>
                        <a data-action="close" href="#"><i class="fa fa-times"></i></a>
                    </div>
                </div>
                <div class="box-content">
                    <div class="row">
                        <div class="col-md-2 col-sm-4">
                            <div class="tile tile-green">
                                <div class="caption text-center">
                                    Score
                                </div>
                                <p class="title text-center"><%-experianCompany.BureauScore%></p>
                            </div>
                        </div>
                        <div class="col-md-2 col-sm-4">
                            <div class="tile tile-green">
                                <div class="caption text-center">
                                    CCJ
                                </div>
                                <p class="title text-center">N/A</p>
                            </div>
                        </div>
                        <div class="col-md-2 col-sm-4">
                            <div class="tile tile-orange">
                                <div class="caption text-center">
                                    Tangible equity
                                </div>
                                <p class="title text-center">N/A</p>
                            </div>
                        </div>
                        <div class="col-md-2 col-sm-4">
                            <div class="tile tile-green">
                                <div class="caption text-center">
                                    Adjusted profit
                                </div>
                                <p class="title text-center">N/A</p>
                            </div>
                        </div>
                        <div class="col-md-2 col-sm-4">
                            <div class="tile tile-transparant">
                                <span class="inline-sparkline companyScoreGraph"></span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-md-5 col-sm-12">
            <div class="box">
                <div class="box-title">
                    <h3><i class="fa fa-bar-chart-o"></i>Assets & Worth</h3>
                    <div class="box-tool">
                        <a data-action="collapse" href="#"><i class="fa fa-chevron-up"></i></a>
                        <a data-action="close" href="#"><i class="fa fa-times"></i></a>
                    </div>
                </div>
                <div class="box-content">
                    <div class="row">
                        <div class="col-md-6 col-sm-6">
                            <div class="tile tile-grey">
                                <div class="caption text-center">
                                    Properties
                                </div>
                                <p class="title text-center"><%- properties.NumberOfProperties %></p>
                            </div>
                        </div>
                        <div class="col-md-6 col-sm-6">
                            <div class="tile tile-grey">
                                <div class="caption text-center">
                                    Market value
                                </div>
                                <p class="title text-center"><%- EzBob.formatPoundsAsThousandsNoDecimals(properties.MarketValue) %></p>
                            </div>
                        </div>
                        <div class="col-md-6 col-sm-6">
                            <div class="tile tile-lightgrey tile-high">
                                <div class="caption text-center">
                                    Net Worth
                                </div>
                                <p class="title text-center blue"><%- EzBob.formatPoundsAsThousandsNoDecimals(properties.NetWorth) %></p>
                                <p class="title-small text-center">(<%- properties.NetWorthPercentages %>%)</p>
                            </div>
                        </div>
                        <div class="col-md-6 col-sm-6">
                            <div class="tile tile-lightgrey tile-high">
                                <div class="caption text-center">
                                    Mortgages (<%- properties.NumberOfMortgages %>)
                                </div>
                                <p class="title text-center"><%- EzBob.formatPoundsAsThousandsNoDecimals(properties.SumOfMortgages) %></p>
                                <p class="title-small text-center">(LTV: <%- properties.Ltv %>%)</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div>
        <%if(affordability){%>
        <div class="col-md-7">
            <div class="box">
                <div class="box-title">
                    <h3><i class="fa fa-bar-chart-o"></i>Affordability</h3>
                    <div class="box-tool">
                        <a data-action="collapse" href="#"><i class="fa fa-chevron-up"></i></a>
                        <a data-action="close" href="#"><i class="fa fa-times"></i></a>
                    </div>
                </div>
                <div class="box-content">
                    <table class="table table-striped">
                        <thead>
                            <tr>
                                <th>caption text-center</th>
                                <th>Value</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>annual</td>
                                <td>in 000</td>
                            </tr>
                            <tr>
                                <td>revenues</td>
                                <td>333</td>
                            </tr>
                            <tr>
                                <td>opex</td>
                                <td>300</td>
                            </tr>
                            <tr class="chkpt">
                                <td>gross profit</td>
                                <td>33</td>
                            </tr>
                            <tr>
                                <td>salaries</td>
                                <td>30</td>
                            </tr>
                            <tr>
                                <td>tax</td>
                                <td>3</td>
                            </tr>
                            <tr class="chkpt">
                                <td>EBITDA</td>
                                <td>0</td>
                            </tr>
                            <tr>
                                <td>loan repayment</td>
                                <td>15</td>
                            </tr>
                            <tr class="chkpt">
                                <td>FCF</td>
                                <td><span class="label label-large label-important">(500K)</span></td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
        <%}%>
    </div>

    <div>
        <%if(m.LoanActivity && m.Decisions && m.Decisions.TotalDecisionsCount > 0){
            var activeLoans = m.LoanActivity.TotalIssuesCount > 0 ? "active" : "";
            var activeDecisions = activeLoans == "" ? "active" : "";
        %>
        <div class="col-md-7">
            <div class="box">
                <div class="box-title">
                    <h3><i class="fa fa-bar-chart-o"></i>Customer History</h3>
                    <div class="box-tool">
                        <a data-action="collapse" href="#"><i class="fa fa-chevron-up"></i></a>
                        <a data-action="close" href="#"><i class="fa fa-times"></i></a>
                    </div>
                </div>
                <div class="box-content">
                    <div class="tabbable tabs-left">
                        <ul class="nav nav-tabs active-red">
                            <li class="<%-activeLoans%>"><a href="#loans" data-toggle="tab"><span class="label label-large label-warning"><%-m.LoanActivity.TotalIssuesCount%></span>&nbsp;Loans</a></li>
                            <li class="<%-activeDecisions%>"><a href="#decisions" data-toggle="tab"><span class="label label-large label-success"><%-m.Decisions.TotalDecisionsCount%></span>&nbsp;Decisions</a></li>
                        </ul>
                        <div class="tab-content">
                            <div class="tab-pane fade <%-activeLoans%> in" id="loans">
                                <ul class="summary-offer">
                                    <li>
                                        <p>
                                            <span>Total issues</span>
                                            <span><%-EzBob.formatPoundsNoDecimals(m.LoanActivity.TotalIssuesSum)%></span>
                                            <span><%-m.LoanActivity.TotalIssuesCount%></span>
                                        </p>
                                    </li>
                                    <li>
                                        <p>
                                            <span>Repaid</span>
                                            <span><%-EzBob.formatPoundsNoDecimals(m.LoanActivity.RepaidSum)%></span>
                                            <span><%-m.LoanActivity.RepaidCount%></span>
                                        </p>
                                    </li>
                                    <li>
                                        <p>
                                            <span>Active</span>
                                            <span><%-EzBob.formatPoundsNoDecimals(m.LoanActivity.ActiveSum)%></span>
                                            <span><%-m.LoanActivity.ActiveCount%></span>
                                        </p>
                                    </li>
                                    <li>
                                        <p>
                                            <span>Earned interest</span>
                                            <span><%-EzBob.formatPoundsNoDecimals(m.LoanActivity.EarnedInterest)%></span>
                                        </p>
                                    </li>
                                </ul>
                            </div>
                            <div class="tab-pane fade <%-activeDecisions%> in" id="decisions">
                                <ul class="summary-offer">
                                    <li>
                                        <p>
                                            <span># Decisions</span>
                                            <span><%-m.Decisions.TotalDecisionsCount%></span>
                                        </p>
                                    </li>
                                    <li>
                                        <p>
                                            <span>Total approved</span>
                                            <span><%-EzBob.formatPoundsNoDecimals(m.Decisions.TotalApprovedAmount)%></span>
                                        </p>
                                    </li>
                                    <li>
                                        <p>
                                            <span># Rejects</span>
                                            <span><%-m.Decisions.RejectsCount%></span>
                                        </p>
                                    </li>
                                    <%if(m.Decisions.LastInterestRate > 0){%>
                                    <li>
                                        <p>
                                            <span>Last interest rate</span>
                                            <span><%-EzBob.formatPercents(m.Decisions.LastInterestRate)%></span>
                                        </p>
                                    </li>
                                    <li>
                                        <p>
                                            <span>Last approval date</span>
                                            <span><%-EzBob.formatDate(new Date(moment(m.Decisions.LastDecisionDate)))%></span>
                                        </p>
                                    </li>
                                    <li>
                                        <p>
                                            <span>Time past from last approval</span>
                                            <span><%-moment(m.Decisions.LastDecisionDate).fromNow()%></span>
                                        </p>
                                    </li>
                                    <%}%>
                                </ul>
                            </div>
                            <div class="tab-pane fade" id="rejects">
                                <table class="table table-striped">
                                    <thead>
                                        <tr>
                                            <th>Date</th>
                                            <th>Comment</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                            <td>Oct 1 2013</td>
                                            <td>low sales</td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <%}%>
        <%if(crm && crm.length > 0) {%>
        <div class="col-md-5">
            <div class="box">
                <div class="box-title">
                    <h3><i class="fa fa-bar-chart-o"></i>Customer Relations</h3>
                    <div class="box-tool">
                        <a data-action="collapse" href="#"><i class="fa fa-chevron-up"></i></a>
                        <a data-action="close" href="#"><i class="fa fa-times"></i></a>
                    </div>
                </div>
                <div class="box-content">
                    <table class="table table-striped">
                        <thead>
                            <tr>
                                <th>Date</th>
                                <th>User</th>
                                <th>Action</th>
                                <th>In\Out</th>
                                <th>Comment</th>
                            </tr>
                        </thead>
                        <tbody>
                            <% _.each(crm, function(item, i){ %>
                            <tr>
                                <td><%-EzBob.formatDate(new Date(moment(item.DateTime)))%></td>
                                <td><%-item.User%></td>
                                <td><%-item.Action%></td>
                                <td><%-item.InOut%></td>
                                <td><%-item.Comment%></td>
                            </tr>
                            <%});%>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
        <%}%>
    </div>
</script>

