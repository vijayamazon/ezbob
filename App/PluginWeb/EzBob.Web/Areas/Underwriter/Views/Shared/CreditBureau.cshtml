@using EzBob.Web.Areas.Underwriter.Models
@model dynamic

@helper ButtonStatus(string checkStatus, string checkIcon, string btnStyle)
{
    var icon = "<i class=\"" + checkIcon + "\"></i>";
    var btn = "<a class=\"btn " + btnStyle + " disabled\">" + icon + "&nbsp;" + checkStatus + "</a>";
    
    <div class="control-group">
        <label class="control-label">Credit bureau check</label>
        <div class="controls">
            @Html.Raw(btn)
        </div>
    </div>
}

@helper RawHeaderCell(params string[] arguments)
    {
    <tr>
        <th colspan="@arguments.Length">@Html.Raw(arguments[0])</th>
    </tr>
}

@helper RawCell(params string[] arguments)
    {
    <tr>
        @foreach (var s in arguments)
        {
            <td>@Html.Raw(s)</td>    
        }
    </tr>
}

@helper RawCellCentered(params string[] arguments)
{
    <tr>
        @foreach (var s in arguments)
        {
            <td style="text-align: center;">@Html.Raw(s)</td>    
        }
    </tr>
}

@helper ScoreMark(string score, string scorePos, string valPos, string color, string align)
{
        var backDivStyle = "height: 50px; width: 128px; position: relative; left: " + scorePos + "background-color: " + color;
        var scoreDivStyle = "height: 50px; width: 120px; background-color: white; position: relative; font-size: 48px; "
            + " color: " + color
            + " left: " + valPos
            + " text-align: " + align;
    <div style="height: 50px;">
        @Html.Raw("<div style=\"" + backDivStyle + "\">" + "<div style=\"" + scoreDivStyle + "\">" + score + "</div></div>")
    </div>
    <div style="height: 100px;">
        <img src="@Url.Content("~/Content/img/scoreband.png")" />
    </div>
}

@helper InputTextSmallReadOnly(string id, string caption, string value)
{
    <div class="control-group">
        <label for="@id" class="control-label">@caption</label>
        <div class="controls">
            @Html.Raw("<input class=\"input-small\" id=\""+id+"\" name=\""+id+"\" readonly=\"readonly\" type=\"text\" value=\"" +value +"\" />")
        </div>
    </div>
}

@helper BureauSummary(string checkStatus, string checkIcon, string buttonStyle, string score, string borrowerType, string checkDate, string checkValidity, string creditBureauDirectorId = null)
{
<div class="row">
    <div class="span6 control-group form-horizontal">
        @ButtonStatus(checkStatus, checkIcon, buttonStyle)
        <a href="#" class="btn btn-mini" data-bug-type="ExpConsumer" data-credit-bureau-director-id="@Html.Raw(@creditBureauDirectorId)" data-bug-customer="<%=experianInfo.Id%>" style="float:right"><i class="icon-tag"></i></a>
        @InputTextSmallReadOnly("creditb-score", "Credit bureau score", score)
        @InputTextSmallReadOnly("creditb-borrower-type", "Borrower type", borrowerType)
    </div>
    <div class="span6 control-group form-horizontal">
        @InputTextSmallReadOnly("creditb-check-date", "Check date", checkDate)
        @InputTextSmallReadOnly("creditb-valid-till", "Check is valid till", checkValidity)
    </div>
</div>
}

@helper RunCheckButton()
{
<div class="row-fluid">
    <div class="span12 control-group">
        <a class="btn" href="#" id="RunCheckBtn">Run check</a>
    </div>
</div>
}

@helper RunReCheckButton()
{
<div class="row-fluid">
    <div class="span12 control-group">
        <a class="btn pull-right" href="#" id="RunBWAReCheckBtn">Recheck BWA</a>
        <a class="btn pull-right" href="#" id="RunAMLReCheckBtn">Recheck AML</a>
        <a class="btn pull-right" href="#" id="RunReCheckBtn">Recheck credit</a>
    </div>
</div>
}

@helper RunIdHubChecksButtons()
{
<div class="row-fluid">
    <div class="span12 control-group">
        <a class="btn" href="#" id="RunAMLCheckBtn">Check AML</a>
        <a class="btn" href="#" id="RunAMLBWACheckBtn">Check AML&amp;BWA</a>
        <a class="btn" href="#" id="RunBWACheckBtn">Check BWA</a>
    </div>
</div>
}

@helper DisplayConsumerData()
{
    <fieldset style="width: 100%;"><legend>Consumer</legend>
        <div class="row-fluid">
            <div class="accordion page-content-frame" id="accordion-credit-bureau">
                <div class="accordion-heading">
                    <a class="accordion-toggle" data-toggle="collapse" href="#collapseSummary">
                        <b class="play"></b>Credit Bureau Summary for  <%-experianInfo.FullName%></a>
                </div>
                <div id="collapseSummary" class="accordion-body collapse">
                    <div class="accordion-inner">
                        @BureauSummary("<%-experianInfo.CheckStatus%>", "<%-experianInfo.CheckIcon%>", "<%-experianInfo.ButtonStyle%>",
                                       "<%-experianInfo.Score%>", "<%-experianInfo.BorrowerType%>",
                                       "<%-experianInfo.CheckDate%>", "<%-experianInfo.CheckValidity%>")
                        <div class="row">
                            <div class="span6">
                                <table class="table table-condensed table-striped">
                                    <tbody>
                                        @{
                                            var amlBugBtn = "<a href=\"#\" style='float:right' class=\"btn btn-mini\" data-bug-type=\"ExpAML\" data-bug-customer=\"<%=experianInfo.Id%>\" ><i class=\"icon-tag\"></i></a>";
                                            var bwaBugBtn = "<a href=\"#\" style='float:right' class=\"btn btn-mini\" data-bug-type=\"ExpBWA\" data-bug-customer=\"<%=experianInfo.Id%>\" ><i class=\"icon-tag\"></i></a>";
                                        }
                                        <% if (experianInfo.AmlInfo != null) { %>
                                        @RawCell("AML Check Result", "<%- experianInfo.AmlInfo.AMLResult %>" + amlBugBtn)
                                        <% } else { %>
                                        @RawCell("AML Check Result", "No information" + amlBugBtn)
                                        <% } %>

                                        <% if (experianInfo.BavInfo != null) { %>
                                        @RawCell("BWA Check Result", "<%- experianInfo.BavInfo.BankAccountVerificationResult %>" + bwaBugBtn)
                                        <% } else { %>
                                        @RawCell("BWA CheckResult", "No information" + bwaBugBtn)
                                        <% } %>
                                    </tbody>
                                </table>        
                            </div>
                        </div>               
                        <% if(experianInfo.ModelType == "Consumer") { %>
                        @RunCheckButton()
                        <% } %>
                    </div>
                </div>

                <div class="accordion-heading">
                    <a class="accordion-toggle" data-toggle="collapse" href="#collapseDetails">
                        <b class="play"></b>Delphi Score Details</a>
                </div>
                <div id="collapseDetails" class="accordion-body collapse">
                    <div class="accordion-inner">
                        <div class="row-fluid">
                            <div class="span12">
                                @ScoreMark("<%- experianInfo.Score %>",
                                           "<%- experianInfo.ScorePosition %>",
                                           "<%- experianInfo.ScoreValuePosition %>",
                                           "<%- experianInfo.ScoreColor %>",
                                           "<%- experianInfo.ScoreAlign %>")
                            </div>
                        </div>
                        <div class="row-fluid">
                            <div class="span6">
                                <table class="table table-condensed table-striped">
                                    <tbody>
                                        @RawCell("Delphi Score is", "<%- experianInfo.Score %>")
                                        @RawCell("Consumer Indebtedness Index", "<%- experianInfo.CII %>")
                                    </tbody>
                                </table>        
                            </div>
                        </div>
                    </div>
                </div>

                <div class="accordion-heading">
                    <a class="accordion-toggle" data-toggle="collapse" href="#collapseAML">
                        <b class="play"></b>AML and BWA Checks</a>
                </div>
                <div id="collapseAML" class="accordion-body collapse">
                    <div class="accordion-inner">
                        <% if (experianInfo.AmlInfo != null) { %>
                        <div class="row-fluid">
                            <div class="span12">
                                <table class="table table-condensed table-striped">
                                    <tbody>
                                        @RawCell("AML Check Result", "<%- experianInfo.AmlInfo.AMLResult %>")
                                        @RawCell("Authentication Index", "<%- experianInfo.AmlInfo.AuthenticationIndexType %>")
                                        @RawCell("Description", "<%- experianInfo.AmlInfo.AuthIndexText %>")
                                    </tbody>
                                </table>        
                            </div>
                        </div>
                        <div class="row-fluid">
                            <div class="span6 control-group form-horizontal">
                                @InputTextSmallReadOnly("aml-prim-items", "Data items", "<%- experianInfo.AmlInfo.NumPrimDataItems %>")
                                @InputTextSmallReadOnly("aml-prim-srcs", "Data sources", "<%- experianInfo.AmlInfo.NumPrimDataSources %>")
                                @InputTextSmallReadOnly("aml-prim-date", "From date", "<%- experianInfo.AmlInfo.StartDateOldestPrim %>")
                            </div>
                            <div class="span6 control-group form-horizontal">
                                @InputTextSmallReadOnly("aml-sec-items", "Sec items", "<%- experianInfo.AmlInfo.NumSecDataItems %>")
                                @InputTextSmallReadOnly("aml-sec-date", "Sec date", "<%- experianInfo.AmlInfo.StartDateOldestSec %>")
                                @InputTextSmallReadOnly("aml-hrp-count", "HRP", "<%- experianInfo.AmlInfo.ReturnedHRPCount %>")
                            </div>
                        </div>
                        <% } else { %>
                        <div class="row-fluid">
                            <div class="span6">
                                <table class="table table-condensed table-striped">
                                    <tbody>
                                        @RawCell("AML Check Result", "No information")
                                    </tbody>
                                </table>        
                            </div>
                        </div>
                        <% } %>
                        <% if (experianInfo.BavInfo != null) { %>
                        <div class="row-fluid">
                            <div class="span12">
                                <table class="table table-condensed table-striped">
                                    <tbody>
                                        @RawCell("BWA Check Result", "<%- experianInfo.BavInfo.BankAccountVerificationResult %>")
                                        @RawCell("Description", "<%- experianInfo.BavInfo.AuthenticationText %>")
                                    </tbody>
                                </table>        
                            </div>
                        </div>
                        <div class="row-fluid">
                            <div class="span6 control-group form-horizontal">
                                @InputTextSmallReadOnly("bav-name-score", "Name score", "<%- experianInfo.BavInfo.NameScore %>")
                                @InputTextSmallReadOnly("bav-addr-srcs", "Address score", "<%- experianInfo.BavInfo.AddressScore %>")
                                @InputTextSmallReadOnly("bav-status", "Status", "<%- experianInfo.BavInfo.AccountStatus %>")
                            </div>
                        </div>
                        <% } else { %>
                        <div class="row-fluid">
                            <div class="span6">
                                <table class="table table-condensed table-striped">
                                    <tbody>
                                        @RawCell("BWA Check Result", "No information")
                                    </tbody>
                                </table>        
                            </div>
                        </div>
                        <% } %>
                        @RunIdHubChecksButtons()
                    </div>
                </div>

                <div class="accordion-heading">
                    <a class="accordion-toggle" data-toggle="collapse" href="#collapseCharacteristics">
                        <b class="play"></b>Summary characteristics</a>
                </div>
                <div id="collapseCharacteristics" class="accordion-body collapse">
                    <div class="accordion-inner">
                        <div class="row-fluid">
                            <div class="span6 control-group form-horizontal">
                                <table class="table table-condensed table-striped">
                                    <tbody>
                                        @RawCell("Number of accounts", "<%- experianInfo.ConsumerSummaryCharacteristics.NumberOfAccounts %>")
                                        @RawCell("Number of accounts in last 3 months", "<%- experianInfo.ConsumerSummaryCharacteristics.NumberOfAccounts3M %>")
                                        @RawCell("Worst current status", "<%- experianInfo.ConsumerSummaryCharacteristics.WorstCurrentStatus %>")
                                        @RawCell("Worst historical status", "<%- experianInfo.ConsumerSummaryCharacteristics.WorstCurrentStatus3M %>")
                                        @RawCell("Number of defaults", "<%- experianInfo.ConsumerSummaryCharacteristics.NumberOfDefaults %>")
                                        @RawCell("Number of CCJs", "<%- experianInfo.ConsumerSummaryCharacteristics.NumberOfCCJs %>")
                                        @RawCell("Age of most recent CCJ", "<%- experianInfo.ConsumerSummaryCharacteristics.AgeOfMostRecentCCJ %>")
                                        @RawCell("Number credit cards over limit", "<%- experianInfo.ConsumerSummaryCharacteristics.NumberOfCCOverLimit %>")
                                    </tbody>
                                </table>        
                            </div>
                            <div class="span6 control-group form-horizontal">
                                <table class="table table-condensed table-striped">
                                    <tbody>
                                        @RawCell("Enquiries in last 3 months", "<%- experianInfo.ConsumerSummaryCharacteristics.EnquiriesLast3M %>")
                                        @RawCell("Enquiries in last 6 months", "<%- experianInfo.ConsumerSummaryCharacteristics.EnquiriesLast6M %>")
                                        @RawCell("Credit card utilization", "<%- experianInfo.ConsumerSummaryCharacteristics.CreditCardUtilization %>")
                                        @RawCell("DSR and ownership type", "<%- experianInfo.ConsumerSummaryCharacteristics.DSRandOwnershipType %>")
                                        @RawCell("Has NOCs on CCJ", "<%- experianInfo.ConsumerSummaryCharacteristics.NOCsOnCCJ %>")
                                        @RawCell("Has NOCs on CAIS", "<%- experianInfo.ConsumerSummaryCharacteristics.NOCsOnCAIS %>")
                                        @RawCell("CAIS Special Instruction Flag", "<%- experianInfo.ConsumerSummaryCharacteristics.CAISSpecialInstructionFlag %>")
                                        @RawCell("Satisfied judgements", "<%- experianInfo.ConsumerSummaryCharacteristics.SatisfiedJudgements %>")
                                    </tbody>
                                </table>        
                            </div>
                        </div>
                    </div>
                </div>

                <div class="accordion-heading">
                    <a class="accordion-toggle" data-toggle="collapse" href="#collapseAccountOverview">
                        <b class="play"></b>Account Overview</a>
                </div>
                <div id="collapseAccountOverview" class="accordion-body collapse">
                    <div class="accordion-inner">
                        <div class="row-fluid">
                            <div class="span12 control-group form-horizontal">
                                <table class="table table-condensed table-striped">
                                    <thead>
                                        <tr>
                                            <th>Type</th>
                                            <th>Open Accounts</th>
                                            <th>Worst Arrears</th>
                                            <th>Total Current Limits</th>
                                            <th>Total Balance</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        @RawCell("Credit Cards",
                                                 "<%- experianInfo.ConsumerAccountsOverview.OpenAccounts_CC %>",
                                                 "<%- experianInfo.ConsumerAccountsOverview.WorstArrears_CC %>",
                                                 "<%- experianInfo.ConsumerAccountsOverview.TotalCurLimits_CC %>",
                                                 "<%- experianInfo.ConsumerAccountsOverview.Balance_CC %>")
                                        @RawCell("Mortgages",
                                                 "<%- experianInfo.ConsumerAccountsOverview.OpenAccounts_Mtg %>",
                                                 "<%- experianInfo.ConsumerAccountsOverview.WorstArrears_Mtg %>",
                                                 "<%- experianInfo.ConsumerAccountsOverview.TotalCurLimits_Mtg %>",
                                                 "<%- experianInfo.ConsumerAccountsOverview.Balance_Mtg %>")
                                        @RawCell("Personal Loans",
                                                 "<%- experianInfo.ConsumerAccountsOverview.OpenAccounts_PL %>",
                                                 "<%- experianInfo.ConsumerAccountsOverview.WorstArrears_PL %>",
                                                 "<%- experianInfo.ConsumerAccountsOverview.TotalCurLimits_PL %>",
                                                 "<%- experianInfo.ConsumerAccountsOverview.Balance_PL %>")
                                        @RawCell("Other",
                                                 "<%- experianInfo.ConsumerAccountsOverview.OpenAccounts_Other %>",
                                                 "<%- experianInfo.ConsumerAccountsOverview.WorstArrears_Other %>",
                                                 "<%- experianInfo.ConsumerAccountsOverview.TotalCurLimits_Other %>",
                                                 "<%- experianInfo.ConsumerAccountsOverview.Balance_Other %>")
                                    </tbody>
                                    <tfoot>                    
                                        @RawCell("Total",
                                                 "<%- experianInfo.ConsumerAccountsOverview.OpenAccounts_Total %>",
                                                 "<%- experianInfo.ConsumerAccountsOverview.WorstArrears_Total %>",
                                                 "<%- experianInfo.ConsumerAccountsOverview.TotalCurLimits_Total %>",
                                                 "<%- experianInfo.ConsumerAccountsOverview.Balance_Total %>")
                                    </tfoot>
                                </table>        
                            </div>
                        </div>
                    </div>
                </div>

                @FinancialAccounts()

                <% if (experianInfo.HasNOCs) { %>
                <div class="accordion-heading">
                    <a class="accordion-toggle" data-toggle="collapse" href="#collapseNOCs">
                        <b class="play"></b>Notices of Correction (NOCs)</a>
                </div>
                <div id="collapseNOCs" class="accordion-body collapse">
                    <div class="accordion-inner">
                        <div class="row-fluid">
                            <div class="span12 control-group form-horizontal">    
                                <%
                                _.each(experianInfo.NOCs, function(noc){
                                %>   
                                <table>
                                    @RawCell("NOC Reference", "<%- noc.NOCReference %>")
                                    @RawCell("NOC Lines", "<%- noc.NOCLines %>")
                                </table>
                                <%
                                });
                                %>
                            </div>
                        </div>
                    </div>
                </div>
                <% } %>
    
                <% if (experianInfo.IsError) { %>
                <div class="accordion-heading">
                    <a class="accordion-toggle" data-toggle="collapse" href="#collapseExperianResponseErrors">
                        <b class="play"></b>Experian response parsing errors</a>
                </div>
                <div id="collapseExperianResponseErrors" class="accordion-body collapse" style="width: 900px;">
                    <div class="accordion-inner">
                        <div class="row-fluid">
                            <div class="span12">
                                <ul>
                                    <% _.each(experianInfo.ErrorList, function(errMessage){ %>
                                    <li>@Html.Raw("<%- errMessage %>")</li>
                                    <% }); %>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
                <% }%>
            </div>
            <div id="idhub-custom-address"></div>
        </div>   
    </fieldset> 
    }

@helper DisplayExperianError()
{
<div class="span9 accordion page-content-frame" id="accordion-request-error">
    <div class="accordion-heading">
        <a class="accordion-toggle" data-toggle="collapse" href="#collapseExperianRequestFailed">
            <b class="play"></b>Experian Request failed</a>
    </div>
    <div id="collapseExperianRequestFailed" class="accordion-body collapse">
        <div class="accordion-inner">
            <div class="row">
                <div class="span8">
                    <ul>
                    <% _.each(experianInfo.ErrorList, function(errMessage){ %>
                        <li>@Html.Raw("<%- errMessage %>")</li>
                    <% }); %>
                    </ul>
                </div>
            </div>
         </div>
    </div>
</div>
}

@helper DisplayFailedExperianCheck()
{
    <h3>No bureau data to evaluate the customer</h3>
    @BureauSummary("<%-experianInfo.CheckStatus%>", "<%-experianInfo.CheckIcon%>", "<%-experianInfo.ButtonStyle%>",
                   "<%-experianInfo.Score%>", "<%-experianInfo.BorrowerType%>",
                   "<%-experianInfo.CheckDate%>", "<%-experianInfo.CheckValidity%>")
}

@helper DisplayLimitedData()
{
    <div class="row-fluid">
        <div class="span9 accordion page-content-frame" id="accordion-limited">
            <fieldset><legend>Business</legend>
                <div class="accordion-heading">
                    <a class="accordion-toggle" data-toggle="collapse" href="#collapseLimited">
                        <b class="play"></b>Company Bureau Check for <%-experianInfo.CompanyName%></a>
                </div>
                <div id="collapseLimited" class="accordion-body collapse">
                    <div class="accordion-inner">
                        <div class="row-fluid">
                            <div class="span6">
                                <table class="table table-condensed table-striped">
                                    <tbody>
                                        @RawCell("Borrower Type", "<%- experianInfo.BorrowerType %>")
                                        @RawCell("Bureau Score", "<%- experianInfo.LimitedInfo.BureauScore %>")
                                        @RawCell("Risk Level", "<%- experianInfo.LimitedInfo.RiskLevel %>")
                                        @RawCell("Existing Business Loans", "<%- experianInfo.LimitedInfo.ExistingBusinessLoans %>")
                                    </tbody>
                                </table>        
                            </div>
                        </div>
                        <% if(experianInfo.ModelType == "Limited") { %>
                        @RunCheckButton()
                        <% } %>
                    </div>
                </div>
            </fieldset>
        </div>
    </div>
}

@helper DisplayNonLimitedData()
{
    <fieldset style="width: 100%"><legend>Business</legend>
        <div class="row-fluid">
            <div class="span9 accordion page-content-frame" id="accordion-nonlimited">
            
                <div class="accordion-heading">
                    <a class="accordion-toggle" data-toggle="collapse" href="#collapseNonLimited">
                        <b class="play"></b>Company Bureau Check for <%-experianInfo.CompanyName%></a>
                </div>
                <div id="collapseNonLimited" class="accordion-body collapse">
                    <div class="accordion-inner">
                        <div class="row-fluid">
                            <div class="span6">
                                <table class="table table-condensed table-striped">
                                    <tbody>
                                        @RawCell("Borrower Type", "<%- experianInfo.BorrowerType %>")
                                        @RawCell("Bureau Score", "<%- experianInfo.NonLimitedInfo.BureauScore %>")
                                        @RawCell("Existing Business Loans", "<%- experianInfo.NonLimitedInfo.CompanyNotFoundOnBureau %>")
                                    </tbody>
                                </table>        
                            </div>
                        </div>
                        <% if(experianInfo.ModelType == "NonLimited") { %>
                        @RunCheckButton()
                        <% } %>
                    </div>
                </div>
            </div>
        </div>
    </fieldset>
}

@helper DisplayDirectors()
{
    <div>
       <% var directorIdx = 0 %>
        <% _.each(experianInfo.directorsModels, function(model,i){ %>   
        <fieldset>
            <legend>Director #<%-i+1%></legend>
        <% var accordionId = 'accordion-credit-bureau' + directorIdx %>
        <div class="row-fluid">
            <div class="accordion page-content-frame" id="<%-accordionId%>">
                <% var collapseSummaryId = 'collapseSummary' + directorIdx %>
                <div class="accordion-heading">
                    <a class="accordion-toggle" data-toggle="collapse" href="#<%-collapseSummaryId%>">
                    <b class="play"></b>Credit Bureau Summary for  <%-model.FullName%></a>
                </div>
                <div id="<%-collapseSummaryId%>" class="accordion-body collapse">
                <div class="accordion-inner">
                    @BureauSummary("<%-model.CheckStatus%>", "<%-model.CheckIcon%>", "<%-model.ButtonStyle%>",
                                   "<%-model.Score%>", "<%-model.BorrowerType%>",
                                   "<%-model.CheckDate%>", "<%-model.CheckValidity%>","<%-model.Id%>")
                </div>
            </div>

                <% var collapseDetailsId = 'collapseDetails' + directorIdx %>
                <div class="accordion-heading">
                    <a class="accordion-toggle" data-toggle="collapse" href="#<%-collapseDetailsId%>">
                        <b class="play"></b>Delphi Score Details</a>
                </div>
                <div id="<%-collapseDetailsId%>" class="accordion-body collapse">
                    <div class="accordion-inner">
                        <div class="row-fluid">
                            <div class="span12">
                                @ScoreMark("<%- model.Score %>",
                                           "<%- model.ScorePosition %>",
                                           "<%- model.ScoreValuePosition %>",
                                           "<%- model.ScoreColor %>",
                                           "<%- model.ScoreAlign %>")
                            </div>
                        </div>
                        <div class="row-fluid">
                            <div class="span12">
                                <table class="table table-condensed table-striped">
                                    <tbody>
                                        @RawCell("Delphi Score is", "<%- model.Score %>")
                                        @RawCell("Consumer Indebtedness Index", "<%- model.CII %>")
                                    </tbody>
                                </table>        
                            </div>
                        </div>
                    </div>
                </div>

                <% var collapseCharacteristicsId = 'collapseCharacteristics' + directorIdx %>
                <div class="accordion-heading">
                    <a class="accordion-toggle" data-toggle="collapse" href="#<%-collapseCharacteristicsId%>">
                        <b class="play"></b>Summary characteristics</a>
                </div>
                <div id="<%-collapseCharacteristicsId%>" class="accordion-body collapse">
                    <div class="accordion-inner">
                        <div class="row-fluid">
                            <div class="span6 control-group form-horizontal">
                                <table class="table table-condensed table-striped">
                                    <tbody>
                                        @RawCell("Number of accounts", "<%- model.ConsumerSummaryCharacteristics.NumberOfAccounts %>")
                                        @RawCell("Number of accounts in last 3 months", "<%- model.ConsumerSummaryCharacteristics.NumberOfAccounts3M %>")
                                        @RawCell("Worst current status", "<%- model.ConsumerSummaryCharacteristics.WorstCurrentStatus %>")
                                        @RawCell("Worst historical status", "<%- model.ConsumerSummaryCharacteristics.WorstCurrentStatus3M %>")
                                        @RawCell("Number of defaults", "<%- model.ConsumerSummaryCharacteristics.NumberOfDefaults %>")
                                        @RawCell("Number of CCJs", "<%- model.ConsumerSummaryCharacteristics.NumberOfCCJs %>")
                                        @RawCell("Age of most recent CCJ", "<%- model.ConsumerSummaryCharacteristics.AgeOfMostRecentCCJ %>")
                                        @RawCell("Number credit cards over limit", "<%- model.ConsumerSummaryCharacteristics.NumberOfCCOverLimit %>")
                                    </tbody>
                                </table>        
                            </div>
                            <div class="span6 control-group form-horizontal">
                                <table class="table table-condensed table-striped">
                                    <tbody>
                                        @RawCell("Enquiries in last 3 months", "<%- model.ConsumerSummaryCharacteristics.EnquiriesLast3M %>")
                                        @RawCell("Enquiries in last 6 months", "<%- model.ConsumerSummaryCharacteristics.EnquiriesLast6M %>")
                                        @RawCell("Credit card utilization", "<%- model.ConsumerSummaryCharacteristics.CreditCardUtilization %>")
                                        @RawCell("DSR and ownership type", "<%- model.ConsumerSummaryCharacteristics.DSRandOwnershipType %>")
                                        @RawCell("Has NOCs on CCJ", "<%- model.ConsumerSummaryCharacteristics.NOCsOnCCJ %>")
                                        @RawCell("Has NOCs on CAIS", "<%- model.ConsumerSummaryCharacteristics.NOCsOnCAIS %>")
                                        @RawCell("CAIS Special Instruction Flag", "<%- model.ConsumerSummaryCharacteristics.CAISSpecialInstructionFlag %>")
                                        @RawCell("Satisfied judgements", "<%- model.ConsumerSummaryCharacteristics.SatisfiedJudgements %>")
                                    </tbody>
                                </table>        
                            </div>
                        </div>
                    </div>
                </div>

                <% var collapseAccountOverviewId = 'collapseAccountOverview' + directorIdx %>
                <div class="accordion-heading">
                    <a class="accordion-toggle" data-toggle="collapse" href="#<%-collapseAccountOverviewId%>">
                        <b class="play"></b>Account Overview</a>
                </div>
                <div id="<%-collapseAccountOverviewId%>" class="accordion-body collapse">
                    <div class="accordion-inner">
                        <div class="row-fluid">
                            <div class="span12 control-group form-horizontal">
                                <table class="table table-condensed table-striped">
                                    <thead>
                                        <tr>
                                            <th>Type</th>
                                            <th>Open Accounts</th>
                                            <th>Worst Arrears</th>
                                            <th>Total Current Limits</th>
                                            <th>Total Balance</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        @RawCell("Credit Cards",
                                                "<%- model.ConsumerAccountsOverview.OpenAccounts_CC %>",
                                                "<%- model.ConsumerAccountsOverview.WorstArrears_CC %>",
                                                "<%- model.ConsumerAccountsOverview.TotalCurLimits_CC %>",
                                                "<%- model.ConsumerAccountsOverview.Balance_CC %>")
                                        @RawCell("Mortgages",
                                                "<%- model.ConsumerAccountsOverview.OpenAccounts_Mtg %>",
                                                "<%- model.ConsumerAccountsOverview.WorstArrears_Mtg %>",
                                                "<%- model.ConsumerAccountsOverview.TotalCurLimits_Mtg %>",
                                                "<%- model.ConsumerAccountsOverview.Balance_Mtg %>")
                                        @RawCell("Personal Loans",
                                                "<%- model.ConsumerAccountsOverview.OpenAccounts_PL %>",
                                                "<%- model.ConsumerAccountsOverview.WorstArrears_PL %>",
                                                "<%- model.ConsumerAccountsOverview.TotalCurLimits_PL %>",
                                                "<%- model.ConsumerAccountsOverview.Balance_PL %>")
                                        @RawCell("Other",
                                                "<%- model.ConsumerAccountsOverview.OpenAccounts_Other %>",
                                                "<%- model.ConsumerAccountsOverview.WorstArrears_Other %>",
                                                "<%- model.ConsumerAccountsOverview.TotalCurLimits_Other %>",
                                                "<%- model.ConsumerAccountsOverview.Balance_Other %>")
                                    </tbody>
                                    <tfoot>                    
                                        @RawCell("Total",
                                                "<%- model.ConsumerAccountsOverview.OpenAccounts_Total %>",
                                                "<%- model.ConsumerAccountsOverview.WorstArrears_Total %>",
                                                "<%- model.ConsumerAccountsOverview.TotalCurLimits_Total %>",
                                                "<%- model.ConsumerAccountsOverview.Balance_Total %>")
                                    </tfoot>
                                </table>        
                            </div>
                        </div>
                    </div>
                </div>

                <% var collapseFinancialAccountsId = 'collapseFinancialAccounts' + directorIdx %>
                <div class="accordion-heading">
                    <a class="accordion-toggle" data-toggle="collapse" href="#<%-collapseFinancialAccountsId%>">
                        <b class="play"></b>Financial Accounts</a>
                </div>
                <div id="<%-collapseFinancialAccountsId%>" class="accordion-body collapse">
                    <div class="accordion-inner">
                        <div class="row-fluid">
                            <div class="span12 control-group form-horizontal">
                                <%
                                _.each(model.AccountsInformation, function(ai,index){
                                %>
                                <div style="overflow: scroll;">
                                    <h2>Account #<%=index+1%></h2>
                                    <table class="table table-bordered table-striped" style="margin-bottom: 0px;">
                                        <thead>
                                            <tr>
                                                <th>Start Date</th>
                                                <th>Account</th>
                                                <th>Term &amp; Frequency</th>
                                                <th>Limit</th>
                                                <th>Balance</th>
                                                <th>Cash Withdrawals</th>
                                                <th>Minimum Payment</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            @RawCell("<%- ai.OpenDate %>", "<%- ai.Account %>", "<%- ai.TermAndfreq %>",
                                                     "<%- ai.Limit %>", "<%- ai.AccBalance %>", "<%- ai.CashWithdrawals %>", "<%- ai.MinimumPayment %>")
                                        </tbody>    
                                    </table>
                                    <table class="table table-bordered table-striped table-finaccount">
                                        <tr>
                                            <% 
                                            _.each(ai.Years, function(y) {
                                            %>
                                            @Html.Raw("<td colspan=\"" + "<%- y.Span %>" + "\">" + "<%- y.Year %>" + "</td>")
                                            <%
                                            });
                                            %>
                                        </tr>
                                        <tr>
                                            <% 
                                            _.each(ai.Quarters, function(q) {
                                            %>
                                            @Html.Raw("<td colspan=\"" + "<%- q.Span %>" + "\">" + "<%- q.Quarter %>" + "</td>")
                                            <%
                                            });
                                            %>
                                        </tr>
                                        <tr>
                                            <% 
                                            _.each(ai.LatestStatuses, function(s) {
                                            %>
                                            <td style="text-align: center;">@Html.Raw("<%- s.Status %>")</td>
                                            <%
                                            });
                                            %>
                                        </tr>
                                        <tr>
                                            <% 
                                            _.each(ai.MonthsDisplayed, function(m) {
                                            %>
                                            <td style="text-align: center;">@Html.Raw("<%- m %>")</td>
                                            <%
                                            });
                                            %>
                                        </tr>
                                    </table>
                                </div>
                                <hr/>
                                <%
                                });
                                %>
                            </div>
                        </div>
                    </div>
                </div>

                <% if (model.HasNOCs) { %>
                <% var collapseNOCsId = 'collapseNOCs' + directorIdx %>
                <div class="accordion-heading">
                    <a class="accordion-toggle" data-toggle="collapse" href="#<%-collapseNOCsId%>">
                        <b class="play"></b>Notices of Correction (NOCs)</a>
                </div>
                <div id="<%-collapseNOCsId%>" class="accordion-body collapse">
                    <div class="accordion-inner">
                        <div class="row-fluid">
                            <div class="span12 control-group form-horizontal">    
                                <%
                                _.each(model.NOCs, function(noc){
                                %>   
                                <table>
                                    @RawCell("NOC Reference", "<%- noc.NOCReference %>")
                                    @RawCell("NOC Lines", "<%- noc.NOCLines %>")
                                </table>
                                <%
                                });
                                %>
                            </div>
                        </div>
                    </div>
                </div>
                <% } %>
    
                <% if (model.IsError) { %>
                <% var collapseExperianResponseErrorsId = 'collapseExperianResponseErrors' + directorIdx %>
                <div class="accordion-heading">
                    <a class="accordion-toggle" data-toggle="collapse" href="#<%-collapseExperianResponseErrorsId%>">
                        <b class="play"></b>Experian response parsing errors</a>
                </div>
                <div id="<%-collapseExperianResponseErrorsId%>" class="accordion-body collapse" style="width: 900px;">
                    <div class="accordion-inner">
                        <div class="row-fluid">
                            <div class="span12">
                                <ul>
                                    <% _.each(model.ErrorList, function(errMessage){ %>
                                    <li>@Html.Raw("<%- errMessage %>")</li>
                                    <% }); %>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
                <% }%>
            </div>
                </div>

        <% directorIdx = directorIdx + 1; %>        
        </fieldset>
        <% }); %>
    </div>
}

<script id="experian-info-template" type="text/template">
    <% if (experianInfo.IsExpirianError) { %>
         @DisplayExperianError()   
    <% } else { %>

    <% if (experianInfo.CheckFailed) { %>
            @DisplayFailedExperianCheck()
            @RunReCheckButton()
         <% } else { %>
            
            @BureauSummaryForCustomer()

            <% if(experianInfo.ModelType == "Consumer") { %>
                @DisplayConsumerData()
            <% } %>
            
            <% if(experianInfo.ModelType == "Limited") { %>
                @DisplayLimitedData()
                @DisplayConsumerData()
                @DisplayDirectors()
             <% } %>

            <% if(experianInfo.ModelType == "NonLimited") { %>
                @DisplayNonLimitedData()
                @DisplayConsumerData()
                @DisplayDirectors()
             <% } %>
         <% } %>
<% }%>
@ExperianConsent()

</script>


<script id="idhub-customaddress-template" type="text/template">
    @IdHubCustomAddress()
</script>

@helper  IdHubCustomAddress()
{
    <div class="idHubCustomAddress">
        <table>
            <tr>
                <td>
                    <fieldset>
                        <legend>Personal Information</legend>
                        <table class="table table-condensed table-striped">
                            <tbody>
                                @RawCell("First name", "<%- customAddress.Firstname %>")
                                @RawCell("Middle name", "<%- customAddress.MiddleName %>")
                                @RawCell("Surname", "<%- customAddress.Surname %>")
                                @RawCell("Gender", "<%- customAddress.Gender %>")
                                @RawCell("Date of birth", "<%- customAddress.DateOfBirth %>")
                            </tbody>
                        </table>        
                    </fieldset>
                </td>
                <td rowspan="2" style="vertical-align: top; padding-left: 40px;">
                    <fieldset>
                        <legend>Set New Address and/or Bank Account</legend>
                        <div class="span4 form-horizontal">
                            @EzForm.InputText("idhub-addr-housenumber", "House Number *", "<%- customAddress.IdHubAddressHouseNumber %>")
                            @EzForm.InputText("idhub-addr-housename", "House Name *", "<%- customAddress.IdHubAddressHouseName %>")
                            @EzForm.InputText("idhub-addr-street", "Street (Mandatory)", "<%- customAddress.IdHubAddressStreet %>")
                            @EzForm.InputText("idhub-addr-district", "District (Optional)", "<%- customAddress.IdHubAddressDistrict %>")
                            @EzForm.InputText("idhub-addr-town", "Town (Mandatory)", "<%- customAddress.IdHubAddressTown %>")
                            @EzForm.InputText("idhub-addr-county", "County (Optional)", "<%- customAddress.IdHubAddressCounty %>")
                            @EzForm.InputText("idhub-addr-postcode", "Postcode (Mandatory)", "<%- customAddress.IdHubAddressPostcode %>")
                            @InputTextSmallReadOnly("idhub-addr-country", "Country(Mandatory)", "<%- customAddress.IdHubAddressCountry %>")
                            @EzForm.InputText("idhub-bankaccount", "Bank Account", "<%- customAddress.BankAccount %>")
                            @EzForm.InputText("idhub-sortcode", "Sort Code", "<%- customAddress.SortCode%>")
                        </div>
                    </fieldset>
                </td>
            </tr>
            <tr>
                <td>
                    <fieldset>
                        <legend>Address Information</legend>
                        <table class="table table-condensed table-striped">
                            <thead>
                                <tr>
                                    <th>Address Field \ Type Of Address</th> 
                                    <th>Current Address</th> 
                                    <th>Previous Address</th> 
                                </tr>
                            </thead>
                            <tbody>
                                @RawCell("Address Line 1", "<%- customAddress.CurAddressLine1 %>", "<%- customAddress.PrevAddressLine1 %>")
                                @RawCell("Address Line 2", "<%- customAddress.CurAddressLine2 %>", "<%- customAddress.PrevAddressLine2 %>")
                                @RawCell("Address Line 3", "<%- customAddress.CurAddressLine3 %>", "<%- customAddress.PrevAddressLine3 %>")
                                @RawCell("Town", "<%- customAddress.CurAddressTown %>", "<%- customAddress.PrevAddressTown %>")
                                @RawCell("County", "<%- customAddress.CurAddressCounty %>", "<%- customAddress.PrevAddressCounty %>")
                                @RawCell("Postcode", "<%- customAddress.CurAddressPostcode %>", "<%- customAddress.PrevAddressPostcode %>")
                                @RawCell("Country", "<%- customAddress.CurAddressCountry %>", "<%- customAddress.PrevAddressCountry %>")
                            </tbody>
                        </table>        
                    </fieldset>
                </td>
            </tr>
        </table>

    </div>
}


@helper FinancialAccounts(){
        <div class="accordion-heading">
            <a class="accordion-toggle" data-toggle="collapse" href="#collapseFinancialAccounts">
                <b class="play"></b>Financial Accounts</a>
        </div>
        <div id="collapseFinancialAccounts" class="accordion-body collapse">
            <div class="accordion-inner">
                <div class="row-fluid">
                    <div class="span12 control-group form-horizontal">
                        <%
                        _.each(experianInfo.AccountsInformation, function(ai, index){
                        %>
                        <div style="overflow: scroll;">
                            <h2>Account #<%=index+1%></h2>
                            <table class="table table-bordered table-striped" style="margin-bottom: 0px; padding: 4px;">
                                <thead>
                                    <tr>
                                        <th>Start Date</th>
                                        <th>Account</th>
                                        <th>Term &amp; Frequency</th>
                                        <th>Limit</th>
                                        <th>Balance</th>
                                        <th>Status</th>
                                        <th>Settlement date</th>
                                        <th>Cash Withdrawals</th>
                                        <th>Minimum Payment</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    @RawCell("<%- ai.OpenDate %>", "<%- ai.Account %>", "<%- ai.TermAndfreq %>",
                                             "<%- ai.Limit %>", "<%- ai.AccBalance %>", "<%- ai.AccountStatus %>", "<%- ai.SettlementDate %>",
                                             "<%- ai.CashWithdrawals %>", "<%- ai.MinimumPayment %>")
                                </tbody>    
                            </table>
                            <table class="table table-bordered table-striped table-finaccount">
                                <tr>
                                    <% 
                                    _.each(ai.Years, function(y) {
                                    %>
                                    @Html.Raw("<td colspan=\"" + "<%- y.Span %>" + "\">" + "<%- y.Year %>" + "</td>")
                                    <%
                                    });
                                    %>
                                </tr>
                                <tr>
                                    <% 
                                    _.each(ai.Quarters, function(q) {
                                    %>
                                    @Html.Raw("<td colspan=\"" + "<%- q.Span %>" + "\">" + "<%- q.Quarter %>" + "</td>")
                                    <%
                                    });
                                    %>
                                </tr>
                                <tr>
                                    <% 
                                    _.each(ai.LatestStatuses, function(s) {
                                    %>
                                    <td style="text-align: center;">@Html.Raw("<%- s.Status %>")</td>
                                    <%
                                    });
                                    %>
                                </tr>
                                <tr>
                                    <% 
                                    _.each(ai.MonthsDisplayed, function(m) {
                                    %>
                                    <td style="text-align: center;">@Html.Raw("<%- m %>")</td>
                                    <%
                                    });
                                    %>
                                </tr>
                            </table>
                        </div>
                        <hr/>
                        <%
                        });
                        %>
                    </div>
                </div>
            </div>
        </div>
}

@helper ExperianConsent(){
    <div class="accordion-heading">
            <a class="accordion-toggle" data-toggle="collapse" href="#collapseExperianConsent"><b class="play"></b>Agreement</a>
    </div>
    <div id="collapseExperianConsent" class="accordion-body collapse">
        <div class="accordion-inner">
            <div class="simple-well" style="margin-bottom: 30px;">
                <div class="row-fluid form-horizontal loan-agreements">
                    <ul>
                        <li><a class="btn-download" href="#">Experian consent</a></li>
                    </ul>
                </div>
            </div>
        </div>
    </div>
}

@helper BureauSummaryForCustomer(){
    <fieldset><legend>Summary</legend>
        <div class="row-fluid">
            <div class="span6">
                <table class="table table-striped blue-header rright">
                    <thead>
                        <tr>
                            @RawHeaderCell("Consumer","")
                        </tr>
                    </thead>
                    <tbody>
                        @RawCell("Score", "<%- experianInfo.Summary.Score  %>")
                        @RawCell("Consumer Indebtedness Index", "<%- experianInfo.Summary.ConsumerIndebtednessIndex  %>")
                        @RawCell("Check Date", "<%- experianInfo.Summary.CheckDate  %>")
                        @RawCell("Valid till", "<%- experianInfo.Summary.Validtill  %>")
                        @RawCell("Worst Current status", "<%- experianInfo.Summary.WorstCurrentstatus  %>")
                        @RawCell("Worst Historical status", "<%- experianInfo.Summary.WorstHistoricalstatus  %>")
                        @RawCell("Number of defaults", "<%- experianInfo.Summary.Numberofdefaults  %>")
                        @RawCell("Accounts", "<%- experianInfo.Summary.Accounts  %>")
                        @RawCell("CCJ's", "<%- experianInfo.Summary.CCJs  %>")
                        @RawCell("Most recent CCJ", "<%- experianInfo.Summary.MostrecentCCJ  %>")
                        @RawCell("DSR and ownership type", "<%- experianInfo.Summary.DSRandownershiptype  %>")
                        @RawCell("Credit card utilization", "<%- experianInfo.Summary.Creditcardutilization  %>")
                        @RawCell("Enquiries in last 6 months", "<%- experianInfo.Summary.Enquiriesinlast6months  %>")
                        @RawCell("Enquiries in last 3 months", "<%- experianInfo.Summary.Enquiriesinlast3months  %>")
                        @RawCell("Total balance", "<%- experianInfo.Summary.Totalbalance  %>")
                    </tbody>
                </table>
            </div>
            <div class="span6">
                <table class="table table-striped blue-header rright">
                    <thead>
                        @RawHeaderCell("Business/AML","","")
                    </thead>
                    <tbody>
                        @RawCell("AML", "<%- experianInfo.Summary.AML  %>","<%- experianInfo.Summary.AMLnum  %>")
                        @RawCell("BWA", "<%- experianInfo.Summary.BWA  %>","<%- experianInfo.Summary.BWAnum  %>")
                        @RawCell("Business type", "<%- experianInfo.Summary.Businesstype  %>","")
                        @RawCell("Business Score", "<%- experianInfo.Summary.BusinessScore  %>","")
                        @RawCell("Risk Level", "<%- experianInfo.Summary.RiskLevel  %>","")
                        @RawCell("Existing business loans", "<%- experianInfo.Summary.Existingbusinessloans  %>","")
                    </tbody>
                </table>
            </div>
        </div>
        <div class="row-fluid">
            <div class="span12">
                <table class="table table-condensed table-striped blue-header">
                    <thead>
                        @RawHeaderCell("Account Overview","","","")
                    </thead>
                    <tbody>
                        @RawCell("Type","Open Accounts","Worst Arrears","Total Balance")
                        @RawCell("Credit Cards",
                                 "<%- experianInfo.Summary.ConsumerAccountsOverview.OpenAccounts_CC %>",
                                 "<%- experianInfo.Summary.ConsumerAccountsOverview.WorstArrears_CC %>",
                                 "<%- experianInfo.Summary.ConsumerAccountsOverview.Balance_CC %>")
                        @RawCell("Mortgages",
                                 "<%- experianInfo.Summary.ConsumerAccountsOverview.OpenAccounts_Mtg %>",
                                 "<%- experianInfo.Summary.ConsumerAccountsOverview.WorstArrears_Mtg %>",
                                 "<%- experianInfo.Summary.ConsumerAccountsOverview.Balance_Mtg %>")
                        @RawCell("Personal Loans",
                                 "<%- experianInfo.Summary.ConsumerAccountsOverview.OpenAccounts_PL %>",
                                 "<%- experianInfo.Summary.ConsumerAccountsOverview.WorstArrears_PL %>",
                                 "<%- experianInfo.Summary.ConsumerAccountsOverview.Balance_PL %>")
                        @RawCell("Other",
                                 "<%- experianInfo.Summary.ConsumerAccountsOverview.OpenAccounts_Other %>",
                                 "<%- experianInfo.Summary.ConsumerAccountsOverview.WorstArrears_Other %>",
                                 "<%- experianInfo.Summary.ConsumerAccountsOverview.Balance_Other %>")
                    </tbody>
                    <tfoot>                    
                        @RawCell("Total",
                                "<%- experianInfo.Summary.ConsumerAccountsOverview.OpenAccounts_Total %>",
                                "<%- experianInfo.Summary.ConsumerAccountsOverview.WorstArrears_Total %>",
                                "<%- experianInfo.Summary.ConsumerAccountsOverview.Balance_Total %>")
                    </tfoot>
                </table>        
            </div>
        </div>
    </fieldset>
}