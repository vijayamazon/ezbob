<?xml version="1.0"?>
<configuration>
	<configSections>
	</configSections>
	<appSettings>
		<add key="aspnet:UseTaskFriendlySynchronizationContext" value="true" />
	</appSettings>
	<system.web>
		<compilation debug="true" targetFramework="4.5" />
		<httpRuntime targetFramework="4.5"/>
	</system.web>

	<system.web.extensions>
		<scripting>
			<webServices>
				<authenticationService enabled="false" requireSSL = "true" />
			</webServices>
		</scripting>
	</system.web.extensions>
	
	<connectionStrings configSource="connection-strings.xml" />


	<system.serviceModel>
		<bindings>
			<webHttpBinding>
				<binding name="secureWeb" contentTypeMapper="EzbobAPI.JsonContentTypeMapper, EzbobAPI, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null">
					<security mode="Transport">
						<!--protectionLevel="EncryptAndSign"-->
						<transport clientCredentialType="None"></transport>
					</security>
				</binding>
				<binding name="nonSecureWeb" contentTypeMapper="EzbobAPI.JsonContentTypeMapper, EzbobAPI, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null" />
			</webHttpBinding>
		</bindings>
		<behaviors>
			<serviceBehaviors>
				<behavior>
					<serviceMetadata httpsGetEnabled="true" httpGetEnabled="false" />
					<serviceDebug includeExceptionDetailInFaults="true"/>
					<serviceCredentials>
						<serviceCertificate findValue="localhost" storeLocation="LocalMachine" storeName="My" x509FindType="FindBySubjectName" />

						<!--<userNameAuthentication userNamePasswordValidationMode="Custom"
												customUserNamePasswordValidatorType="EzbobAPI.PartnerValidator, EzbobAPI"  />-->
						<clientCertificate>
							<!--	Do not authenticate chain of trust -->
							<authentication certificateValidationMode="None" />
						</clientCertificate>
					</serviceCredentials>
				</behavior>
			</serviceBehaviors>
			<endpointBehaviors>
				<behavior>
					<webHttp automaticFormatSelectionEnabled="true"  helpEnabled="true"  />
					<!--defaultBodyStyle="Wrapped"  defaultOutgoingResponseFormat="Json"-->
				</behavior>
			</endpointBehaviors>
		</behaviors>
		<protocolMapping>
			<add scheme="https" binding="webHttpBinding" bindingConfiguration="secureWeb" />
			<add scheme="http" binding="webHttpBinding" bindingConfiguration="nonSecureWeb"  />
		</protocolMapping>
		<services>
			<service name="EzbobAPI.Customer">
				<endpoint address="" binding="webHttpBinding" bindingConfiguration="secureWeb" contract="EzbobAPI.ICustomer">
					<identity>
						<dns value="localhost" />
					</identity>
				</endpoint>
				<endpoint address="" binding="webHttpBinding" bindingConfiguration="nonSecureWeb" contract="EzbobAPI.ICustomer" />
				<host>
					<baseAddresses>
						<add baseAddress="https://localhost:12498/Customer" />
					</baseAddresses>
				</host>
			</service>
			<service name="EzbobAPI.AuthenticationService">
				<endpoint address="" binding="webHttpBinding" bindingConfiguration="secureWeb" contract="EzbobAPI.IAuthenticationService">
					<identity>
						<dns value="localhost" />
					</identity>
				</endpoint>
				<endpoint address="" binding="webHttpBinding" bindingConfiguration="nonSecureWeb" contract="EzbobAPI.IAuthenticationService" />
				<host>
					<baseAddresses>
						<add baseAddress="https://localhost:12498/Authentication" />
					</baseAddresses>
				</host>
			</service>
		</services>


		<serviceHostingEnvironment multipleSiteBindingsEnabled="true" aspNetCompatibilityEnabled="true" minFreeMemoryPercentageToActivateService="0"/>

	</system.serviceModel>

	<system.webServer>
		<modules runAllManagedModulesForAllRequests="true"/>
		<directoryBrowse enabled="true"/>
	</system.webServer>

</configuration>